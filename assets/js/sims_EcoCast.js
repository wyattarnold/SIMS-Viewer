<?xml version "1.0" encoding "UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    
    

    <!-- from Google's CDN: http://code.google.com/apis/libraries/devguide.html#jquery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="https://www.google.com/jsapi?key=AIzaSyCkNM-lXGXN6wykykEmYeqt8O1FNRW80ds" type="text/javascript"></script>
    <script src="http://maps.google.com/maps/api/js?v=3.2&key=AIzaSyCkNM-lXGXN6wykykEmYeqt8O1FNRW80ds&sensor=false"></script>
    <script type="text/javascript" src="http://layout.jquery-dev.net/lib/js/jquery.layout-latest.js"></script>
    <script type="text/javascript" src="/dgwmed/static/jquery_plugins/tablesorter/jquery.tablesorter.js"></script>
    <script type="text/javascript" src="/dgwmed/static/jquery_plugins/jquery.cookie.js"></script>
    <link href="/dgwmed/static/jquery_plugins/tablesorter/tablesorter_blue.css" rel="stylesheet">
    
    <!-- jqPlot resources -->
    <!--[if lt IE 9]><script language="javascript" type="text/javascript" src="excanvas.js"></script><![endif]-->
    <script language="javascript" type="text/javascript" src="/dgwmed/static/jqPlot/jquery.jqplot.min.js"></script>
    <link rel="stylesheet" type="text/css" href="/dgwmed/static/jqPlot/jquery.jqplot.css" />    
    <script type="text/javascript" src="/dgwmed/static/jqPlot/plugins/jqplot.dateAxisRenderer.min.js"></script>
    <script type="text/javascript" src="/dgwmed/static/jqPlot/plugins/jqplot.highlighter.min.js"></script>
    <script type="text/javascript" src="/dgwmed/static/jqPlot/plugins/jqplot.enhancedLegendRenderer.min.js"></script>

    
    <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.18/themes/base/jquery-ui.css" />
    
    <!-- dojo-based stuff.  Try to phase out soon. -->
    <script type="text/javascript" src="/dgwmed/static/dojo-dgw-1.5.0/dojo/dojo.js"
        djConfig="parseOnLoad:true, isDebug:false"></script>
    <link href="/dgwmed/static/dojo-dgw-1.5.0/dijit/themes/tundra/tundra.css" rel="stylesheet">
    <link href="/dgwmed/static/dojo-dgw-1.5.0/dojo/resources/dojo.css" rel="stylesheet" />
    <link href="/dgwmed/static/dojo-dgw-1.5.0/dijit/themes/dijit.css" rel="stylesheet" />
    
    <title>TOPS Satellite Irrigation Management Support</title>
    <script src='/dgwmed/static/OpenLayers-dev/OpenLayers.js' type='text/javascript'></script>
    <style type="text/css"> 
        
html, body {
    width: 100%; height:100%;
    margin: 0;
    -webkit-box-sizing: border-box; /* Safari/Chrome, other WebKit */
    -moz-box-sizing: border-box;    /* Firefox, other Gecko */
    box-sizing: border-box;         /* Opera/IE 8+ */
    font: 12px Myriad,Helvetica,Tahoma,Arial,clean,sans-serif; 
    overflow:hidden;
 }
 #auth_div {
    position:absolute;
    top:5px;
    right:5px;
 }
#header {
	background-color:white;
	background-image:url("/dgwmed/static/images/sat_background.png");
	background-position:right center;
	background-repeat:no-repeat;
    height:71px;
	/*overflow:hidden;
	border:1px solid #CCCCCC;
	padding:3px;*/
}
#header a img {
	border:none;
}
#header_logo {
    float:left;
    margin-bottom:-3px;
    margin-left:5px;
    padding-right:17px;
}
#header_title h1 { font-size:2em; }
/*#content {
    height:100%;
    margin-top:-1px;
}*/
#content { position:relative; }
#legend{ position: absolute; left: 3px; bottom: 0px; z-index: 9999; }
#toolbarContainer{ height: 26px; width: 100%; }
#toolbarContainer table { width:100%; }
#searchForm{padding-left:15px; }
#dateSelectContainer{ padding-right:2px; padding-top:4px; }
#linksTable{ width:100%; margin-top:3px; }
#calendar{ position:absolute; right:20px; top:23px; z-index:9999; }
.olFramedCloudPopupContent{ overflow:hidden !important; }
#footer {
    clear:both;
	background-color:white;
	background-position:right center;
	background-repeat:no-repeat;
	height:37px;
}
#footer a {
	text-decoration:none;
}
#footer table {
	text-align:center;
	width:100%;
	table-layout:fixed;
}
/*.noPadding {
    padding:0;
}
.noBorder {
    border: 0px;
}*/
.bordered-container { 
    border: 1px #CCC solid;
    margin: 5px;
} 
#disclaimer {font-weight:bold;}


/* the following should be included in OpenLayer's css, but it's not. Adding here to avoid modifying their code. */
.olControlEditingToolbar .olControlModifyFeatureItemInactive {
    background-position: 0 0;
}
.olControlEditingToolbar .olControlModifyFeatureItemActive {
    background-position: 0 -23px;
}

/*AG Fixing bug where google maps layer was on top of controls  */
.olControlLayerSwitcher{
  z-index: 3100 !important;
}

.olControlPanZoomBar{
  z-index: 3200 !important;
}

.olControlMousePosition{
  z-index: 2100 !important;
}

.olLayerGoogleCopyright,
.olLayerGooglePoweredBy
{
display: none !important;
}

.poly_query_status {
    display:none;
    width:100%;
    height:100%;
}
.map_query_response table {
    font-family: arial;
    border-collapse: collapse;
}
.map_query_response td {
    border: 1px solid #CCC;
    padding: 1px 5px 0px 5px;
}
.map_query_response th {
    background-color: #E6EEEE;
    border: 1px #CCC solid;
    padding: 1px 5px 0px 5px;
}
.timeseries_summary .year_select { 
    position:absolute;
    right: 27px;
    top: 11px;
    z-index: 2;
}

.olControlEditingToolbar {
	z-index:12000 !important;
}

.ui-datepicker {
	z-index: 12000 !important;
}
.ui-dialog {
z-index: 13000 !important;
}


    </style>
    <script type="text/javascript">
        dojo.require("dijit.Calendar");
        dojo.require("dijit.form.TextBox");
        dojo.require("dijit.form.DateTextBox");
        dojo.require("dijit.form.Button");
        dojo.require("dojox.collections.SortedList");
       
        google.load("jqueryui", "1.8");        
    </script>
   <script type="text/javascript">
// TODO: * Fix click handler so that when polygon is clicked:
//      - check for time-series data in feature attributes
//      - if none found, display time-series query form

var map;
var mapBounds = new OpenLayers.Bounds(-123.91599395, 34.1388962198, -117.866836572, 39.9403312903);
var mapMinZoom = 5;
var mapMaxZoom = 15;
var geocoder;
var polygons = {};

// avoid pink tiles
OpenLayers.IMAGE_RELOAD_ATTEMPTS = 3;
OpenLayers.Util.onImageLoadErrorColor = "transparent";

PROJ_MERC=new OpenLayers.Projection("EPSG:900913");
PROJ_GEO=new OpenLayers.Projection("EPSG:4326");

function init(){
    
    initMap();
    createCalendar();
    styleHacks();    
    setupCSRF();
   
    
}

$('#searchBox').live("keypress", function(e) {
        if (e.keyCode == 13) {
            $("#search").click(); 
        }
});

function setupFormSubmitListeners(){
    var searchTerm = document.getElementById('searchBox').value;
    var coord = searchTerm.split(",")
    if(isNumber(coord[0])&& (parseFloat(coord[0])<parseFloat('42')) && (parseFloat(coord[0]) > parseFloat('32'))      ){//lat range of CA
       if(isNumber(coord[1])&& (parseFloat(coord[1])>parseFloat('-125'))&&(parseFloat(coord[1])<parseFloat('-114'))  ){//long range of CA
          var lat=coord[0];
          var lon=coord[1];
          var searchPt = new OpenLayers.LonLat(lon,lat);
          searchPt.transform(PROJ_GEO,PROJ_MERC);
          map.setCenter(searchPt);
          map.zoomTo(12);
          addMarker(searchPt);
       }
     }
     // if user enters lon,lat instead of lat,lon
     // range is still within CA
      else if(isNumber(coord[0])&&(parseFloat(coord[0])>parseFloat('-125')) && (parseFloat(coord[0]) < parseFloat('-114'))) {
        if(isNumber(coord[1])&&(parseFloat(coord[1])<parseFloat('42'))&&(parseFloat(coord[1])>parseFloat('32'))){
          var lat=coord[1];
          var lon=coord[0];
          var searchPt = new OpenLayers.LonLat(lon,lat);
          searchPt.transform(PROJ_GEO,PROJ_MERC);
          map.setCenter(searchPt);
          map.zoomTo(12);
          addMarker(searchPt);
        }
    }else{
       geocoder.geocode( { 'address': searchTerm}, function(results, status) {
       if (status == 'OK') {
         var latLong = results[0].geometry.location;
         var searchPt = new OpenLayers.LonLat(latLong.lng(),latLong.lat());
         searchPt.transform(PROJ_GEO,PROJ_MERC);
         map.setCenter(searchPt);
         map.zoomTo(12);
         addMarker(searchPt);
       } else {
         //alert("Can't find "+searchTerm);
         alert('Geocode was not successful for the following reason: ' + status);
       }
      });
   }
}

function isNumber(n) {
  return !isNaN(parseFloat(n)) && isFinite(n);
}

function setupCSRF() {
    function sameOrigin(url) {
        // url could be relative or scheme relative or absolute
        var host = document.location.host; // host + port
        var protocol = document.location.protocol;
        var sr_origin = '//' + host;
        var origin = protocol + sr_origin;
        // Allow absolute or scheme relative URLs to same origin
        return (url == origin || url.slice(0, origin.length + 1) == origin + '/') ||
            (url == sr_origin || url.slice(0, sr_origin.length + 1) == sr_origin + '/') ||
            // or any other URL that isn't scheme relative or absolute i.e relative.
            !(/^(\/\/|http:|https:).*/.test(url));
    }
    function safeMethod(method) {
        return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
    }
    $(document).ajaxSend( function(elm, xhr, settings){
        if (!safeMethod(settings.type) && sameOrigin(settings.url)) {
            xhr.setRequestHeader('X-CSRFToken', 'f891d09be3df85b78da85871459a1c05');
        }
    });
}

function initMap() {
    var options = {
        controls: [],
        projection: PROJ_MERC,
        displayProjection: PROJ_GEO,
        units: "m",
        maxResolution: 156543.0339,
        maxExtent: new OpenLayers.Bounds(-20037508, -20037508, 20037508, 20037508.34)
        };
    map = new OpenLayers.Map('map', options);
    geocoder = new google.maps.Geocoder();
      
 
    // create Google Mercator layers
    var gter = new OpenLayers.Layer.Google(
                "Google Physical",
                {type: google.maps.MapTypeId.TERRAIN});
    var gmap = new OpenLayers.Layer.Google(
                "Google Streets", // the default
                {numZoomLevels: 20});
    var gsat = new OpenLayers.Layer.Google(
                "Google Satellite",
                {type: google.maps.MapTypeId.SATELLITE, numZoomLevels: 20} );
    map.addLayers([gmap, gter, gsat]);
    
    // create TMS Overlay layers
    
    var periods=['2010-01-01', '2010-01-09', '2010-01-17', '2010-01-25', '2010-02-02', '2010-02-10', '2010-02-18', '2010-02-26', '2010-03-06', '2010-03-14', '2010-03-22', '2010-03-30', '2010-04-07', '2010-04-15', '2010-04-23', '2010-05-01', '2010-05-09', '2010-05-17', '2010-05-25', '2010-06-02', '2010-06-10', '2010-06-18', '2010-06-26', '2010-07-04', '2010-07-12', '2010-07-20', '2010-07-28', '2010-08-05', '2010-08-13', '2010-08-21', '2010-08-29', '2010-09-06', '2010-09-14', '2010-09-22', '2010-09-30', '2010-10-08', '2010-10-16', '2010-10-24', '2010-11-01', '2010-11-09', '2010-11-17', '2010-11-25', '2010-12-03', '2010-12-11', '2010-12-19', '2010-12-27', '2011-01-01', '2011-01-09', '2011-01-17', '2011-01-25', '2011-02-02', '2011-02-10', '2011-02-18', '2011-02-26', '2011-03-06', '2011-03-14', '2011-03-22', '2011-03-30', '2011-04-07', '2011-04-15', '2011-04-23', '2011-05-01', '2011-05-09', '2011-05-17', '2011-05-25', '2011-06-02', '2011-06-10', '2011-06-18', '2011-06-26', '2011-07-04', '2011-07-12', '2011-07-20', '2011-07-28', '2011-08-05', '2011-08-13', '2011-08-21', '2011-08-29', '2011-09-06', '2011-09-14', '2011-09-22', '2011-09-30', '2011-10-08', '2012-01-01', '2012-01-09', '2012-01-17', '2012-01-25', '2012-02-02', '2012-02-10', '2012-02-18', '2012-02-26', '2012-03-05', '2012-03-13', '2012-03-21', '2012-03-29', '2012-04-06', '2012-04-14', '2012-04-22', '2012-04-30', '2012-05-08', '2012-05-16', '2012-05-24', '2012-06-01', '2012-06-09', '2012-06-17', '2012-06-25', '2012-07-03', '2012-07-11', '2012-07-19', '2012-07-27', '2012-08-04', '2012-08-12', '2012-08-20', '2012-08-28', '2012-09-05', '2012-09-13', '2012-09-21', '2012-09-29', '2012-10-07', '2012-10-15', '2012-10-23', '2012-10-31', '2012-11-08', '2012-11-16', '2012-11-24', '2012-12-02', '2013-01-01', '2013-01-09', '2013-01-17', '2013-01-25', '2013-02-02', '2013-02-10', '2013-02-18', '2013-02-26', '2013-03-06', '2013-03-14', '2013-03-22', '2013-03-30', '2013-04-07', '2013-04-15', '2013-04-23', '2013-05-01', '2013-05-09', '2013-05-17', '2013-05-25', '2013-06-02', '2013-06-10', '2013-06-18', '2013-06-26', '2013-07-04', '2013-07-12', '2013-07-20', '2013-07-28', '2013-08-05', '2013-08-13', '2013-08-21', '2013-08-29', '2013-09-06', '2013-09-14', '2013-09-22', '2013-09-30', '2013-10-08', '2013-10-16', '2013-10-24', '2013-11-01', '2013-11-09', '2013-11-17', '2013-11-25', '2013-12-03', '2013-12-11', '2013-12-19', '2014-01-01', '2014-01-09', '2014-01-17', '2014-01-25', '2014-02-02', '2014-02-10', '2014-02-18', '2014-02-26', '2014-03-06', '2014-03-14', '2014-03-22', '2014-03-30', '2014-04-07', '2014-04-15', '2014-04-23', '2014-05-01', '2014-05-09', '2014-05-17', '2014-05-25', '2014-06-02', '2014-06-10', '2014-06-18', '2014-06-26', '2014-07-04', '2014-07-12', '2014-07-20', '2014-07-28', '2014-08-05', '2014-08-13', '2014-08-21', '2014-08-29', '2014-09-06', '2014-09-14', '2014-09-22', '2014-09-30', '2014-10-08', '2014-10-16', '2014-10-24', '2014-11-01', '2014-11-09', '2014-11-17', '2014-11-25', '2014-12-03', '2014-12-11', '2014-12-19', '2015-01-01', '2015-01-09', '2015-01-17', '2015-01-25', '2015-02-02', '2015-02-10', '2015-02-18', '2015-02-26', '2015-03-06', '2015-03-14', '2015-03-22', '2015-03-30', '2015-04-07', '2015-04-15', '2015-04-23', '2015-05-01', '2015-05-09', '2015-05-17', '2015-05-25', '2015-06-02', '2015-06-10', '2015-06-18', '2015-06-26', '2015-07-04', '2015-07-12', '2015-07-20', '2015-07-28', '2015-08-05', '2015-08-13', '2015-08-21', '2015-08-29', '2015-09-06', '2015-09-14', '2015-09-22', '2015-09-30', '2015-10-08', '2015-10-16', '2015-10-24', '2015-11-01', '2016-01-01', '2016-01-09', '2016-01-17', '2016-01-25', '2016-02-02', '2016-02-10', '2016-02-18', '2016-02-26', '2016-03-05', '2016-03-13', '2016-03-21', '2016-03-29', '2016-04-06', '2016-04-14', '2016-04-22', '2016-04-30', '2016-05-08', '2016-05-16', '2016-05-24', '2016-06-01', '2016-06-09', '2016-06-17', '2016-06-25', '2016-07-03', '2016-07-11', '2016-07-19', '2016-07-27', '2016-08-04', '2016-08-12', '2016-08-20', '2016-08-28', '2016-09-05', '2016-09-13', '2016-09-21', '2016-09-29', '2016-10-07', '2016-10-15', '2016-10-23', '2016-10-31', '2016-11-08', '2016-11-16', '2016-11-24', '2016-12-02', '2016-12-10', '2016-12-18', '2016-12-26', '2017-01-01', '2017-01-09', '2017-01-17', '2017-01-25', '2017-02-02', '2017-02-10', '2017-02-18', '2017-02-26', '2017-03-06', '2017-03-14', '2017-03-22', '2017-03-30', '2017-04-07', '2017-04-15', '2017-04-23', '2017-05-01', '2017-05-09', '2017-05-17', '2017-05-25', '2017-06-02', '2017-06-10', '2017-06-18', '2017-06-26', '2017-07-04', '2017-07-12', '2017-07-20', '2017-07-28', '2017-08-05', '2017-08-13', '2017-08-21', '2017-08-29', '2017-09-06', '2017-09-14', '2017-09-22', '2017-09-30', '2017-10-08', '2017-10-16', '2017-10-24'];
    if (periods.length==0) { // This means there are no tiles available, so create a dummy layer.
        var newLayer = new OpenLayers.Layer.TMS("Veg. Index (NDVI)", "",
            { type: 'png', getURL:overlay_getTileURL, alpha:true, 
              isBaseLayer:false, queryId:"NDVI",
              baseUrl:"",title:"Veg. Index (NDVI)",
              periods:periods,periodLength:8,
              legendUrl:"/dgwmed/static/images/NDVI_legend.png", 
              visibility:false,
              serverZoomIndices: [ ],
              resolutions: []
        });
    } else {
        var newLayer = new OpenLayers.Layer.TMS("Veg. Index (NDVI)", "http://ecocast.arc.nasa.gov/gi/sfdb.gi?CA30M_L5L7_NDVI/"+periods[periods.length-1]+"/",
            { type: 'png', getURL:overlay_getTileURL, alpha:true, 
              isBaseLayer:false, queryId:"NDVI",
              baseUrl:"http://ecocast.arc.nasa.gov/gi/sfdb.gi?CA30M_L5L7_NDVI/",title:"Veg. Index (NDVI)",
              periods:periods,periodLength:8,
              legendUrl:"/dgwmed/static/images/NDVI_legend.png", 
              visibility:false,
              resolutions: [  4891.9698095703125,
                              2445.9849047851562, 1222.9924523925781, 611.4962261962891,
                              305.74811309814453, 152.87405654907226, 76.43702827453613,
                              38.218514137268066, 19.109257068634033, 9.554628534317017,
                              4.777314267158508, 2.388657133579254, 1.194328566789627,
                              0.5971642833948135],
              serverResolutions: [4891.9698095703125, 2445.9849047851562,
                                1222.9924523925781, 611.4962261962891,
                                305.74811309814453, 152.87405654907226,
                                76.43702827453613, 76.43702827453613,
                              38.218514137268066, 19.109257068634033//, 9.554628534317017,
                              //4.777314267158508
                              ],
              serverZoomIndices: [ 5, 6, 7, 8, 9, 10, 11, 12, 13 ]
        });
    }
    map.addLayer(newLayer);
     
    
    var periods=['2011-01-01', '2011-01-09', '2011-01-17', '2011-01-25', '2011-02-02', '2011-02-10', '2011-02-18', '2011-02-26', '2011-03-06', '2011-03-14', '2011-03-22', '2011-03-30', '2011-04-07', '2011-04-15', '2011-04-23', '2011-05-01', '2011-05-09', '2011-05-17', '2011-05-25', '2011-06-02', '2011-06-10', '2011-06-18', '2011-06-26', '2011-07-04', '2011-07-12', '2011-07-20', '2011-07-28', '2011-08-05', '2011-08-13', '2011-08-21', '2011-08-29', '2011-09-06', '2011-09-14', '2011-09-22', '2011-09-30', '2011-10-08', '2012-01-01', '2012-01-09', '2012-02-18', '2012-02-26', '2012-03-05', '2012-03-13', '2012-03-21', '2012-03-29', '2012-04-06', '2012-04-14', '2012-04-22', '2012-04-30', '2012-05-08', '2012-05-16', '2012-05-24', '2012-06-01', '2012-06-09', '2012-06-17', '2012-06-25', '2012-07-03', '2012-07-11', '2012-07-19', '2012-07-27', '2013-01-01', '2013-01-09', '2013-01-17', '2013-01-25', '2013-02-02', '2013-02-10', '2013-02-18', '2013-02-26', '2013-03-06', '2013-03-14', '2013-03-22', '2013-03-30', '2013-04-07', '2013-04-15', '2013-04-23', '2013-05-01', '2013-05-09', '2013-05-17', '2013-05-25', '2013-06-02', '2013-06-10', '2013-06-18', '2013-06-26', '2013-07-04', '2013-07-12', '2013-07-20', '2013-07-28', '2013-08-05', '2013-08-13', '2013-08-21', '2013-08-29', '2013-09-06', '2013-09-14', '2013-09-22', '2013-09-30', '2013-10-08', '2013-10-16', '2013-10-24', '2013-11-01', '2013-11-09', '2013-11-17', '2013-11-25', '2013-12-03', '2013-12-11', '2013-12-19', '2014-01-01', '2014-01-09', '2014-01-17', '2014-01-25', '2014-02-02', '2014-02-10', '2014-02-18', '2014-02-26', '2014-03-06', '2014-03-14', '2014-03-22', '2014-03-30', '2014-04-07', '2014-04-15', '2014-04-23', '2014-05-01', '2014-05-09', '2014-05-17', '2014-05-25', '2014-06-02', '2014-06-10', '2014-06-18', '2014-06-26', '2014-07-04', '2014-07-12', '2014-07-20', '2014-07-28', '2014-08-05', '2014-08-13', '2014-08-21', '2014-08-29', '2014-09-06', '2014-09-14', '2014-09-22', '2014-09-30', '2014-10-08', '2014-10-16', '2014-10-24', '2014-11-01', '2014-11-09', '2014-11-17', '2014-11-25', '2014-12-03', '2014-12-11', '2014-12-19', '2015-01-01', '2015-01-09', '2015-01-17', '2015-01-25', '2015-02-02', '2015-02-10', '2015-02-18', '2015-02-26', '2015-03-06', '2015-03-14', '2015-03-22', '2015-03-30', '2015-04-07', '2015-04-15', '2015-04-23', '2015-05-01', '2015-05-09', '2015-05-17', '2015-05-25', '2015-06-02', '2015-06-10', '2015-06-18', '2015-06-26', '2015-07-04', '2015-07-12', '2015-07-20', '2015-07-28', '2015-08-05', '2015-08-13', '2015-08-21', '2015-08-29', '2015-09-06', '2015-09-14', '2015-09-22', '2015-09-30', '2015-10-08', '2015-10-16', '2015-10-24', '2015-11-01', '2016-01-01', '2016-01-09', '2016-01-17', '2016-01-25', '2016-02-02', '2016-02-10', '2016-02-18', '2016-02-26', '2016-03-05', '2016-03-13', '2016-03-21', '2016-03-29', '2016-04-06', '2016-04-14', '2016-04-22', '2016-04-30', '2016-05-08', '2016-05-16', '2016-05-24', '2016-06-01', '2016-06-09', '2016-06-17', '2016-06-25', '2016-07-03', '2016-07-11', '2016-07-19', '2016-07-27', '2016-08-04', '2016-08-12', '2016-08-20', '2016-08-28', '2016-09-05', '2016-09-13', '2016-09-21', '2016-09-29', '2016-10-07', '2016-10-15', '2016-10-23', '2016-10-31', '2016-11-08', '2016-11-16', '2016-11-24', '2016-12-02', '2016-12-10', '2016-12-18', '2016-12-26', '2017-01-01', '2017-01-09', '2017-01-17', '2017-01-25', '2017-02-02', '2017-02-10', '2017-02-18', '2017-02-26', '2017-03-06', '2017-03-14', '2017-03-22', '2017-03-30', '2017-04-07', '2017-04-15', '2017-04-23', '2017-05-01', '2017-05-09', '2017-05-17', '2017-05-25', '2017-06-02', '2017-06-10', '2017-06-18', '2017-06-26', '2017-07-04', '2017-07-12', '2017-07-20', '2017-07-28', '2017-08-05', '2017-08-13', '2017-08-21', '2017-08-29', '2017-09-06', '2017-09-14', '2017-09-22', '2017-09-30', '2017-10-08', '2017-10-16', '2017-10-24', '2017-11-01', '2017-11-09', '2017-11-17', '2017-11-25', '2017-12-03', '2017-12-11', '2017-12-19', '2017-12-27'];
    if (periods.length==0) { // This means there are no tiles available, so create a dummy layer.
        var newLayer = new OpenLayers.Layer.TMS("Veg. Index (NDVI) gapfilled", "",
            { type: 'png', getURL:overlay_getTileURL, alpha:true, 
              isBaseLayer:false, queryId:"NDVI gapfilled",
              baseUrl:"",title:"Veg. Index (NDVI) gapfilled",
              periods:periods,periodLength:8,
              legendUrl:"/dgwmed/static/images/NDVI_legend.png", 
              visibility:false,
              serverZoomIndices: [ ],
              resolutions: []
        });
    } else {
        var newLayer = new OpenLayers.Layer.TMS("Veg. Index (NDVI) gapfilled", "http://ecocast.arc.nasa.gov/gi/sfdb.gi?CA30M_L5L7_NDVI_GAPFILLED/"+periods[periods.length-1]+"/",
            { type: 'png', getURL:overlay_getTileURL, alpha:true, 
              isBaseLayer:false, queryId:"NDVI gapfilled",
              baseUrl:"http://ecocast.arc.nasa.gov/gi/sfdb.gi?CA30M_L5L7_NDVI_GAPFILLED/",title:"Veg. Index (NDVI) gapfilled",
              periods:periods,periodLength:8,
              legendUrl:"/dgwmed/static/images/NDVI_legend.png", 
              visibility:false,
              resolutions: [  4891.9698095703125,
                              2445.9849047851562, 1222.9924523925781, 611.4962261962891,
                              305.74811309814453, 152.87405654907226, 76.43702827453613,
                              38.218514137268066, 19.109257068634033, 9.554628534317017,
                              4.777314267158508, 2.388657133579254, 1.194328566789627,
                              0.5971642833948135],
              serverResolutions: [4891.9698095703125, 2445.9849047851562,
                                1222.9924523925781, 611.4962261962891,
                                305.74811309814453, 152.87405654907226,
                                76.43702827453613, 76.43702827453613,
                              38.218514137268066, 19.109257068634033//, 9.554628534317017,
                              //4.777314267158508
                              ],
              serverZoomIndices: [ 5, 6, 7, 8, 9, 10, 11, 12, 13 ]
        });
    }
    map.addLayer(newLayer);
     
    
    var periods=['2010-01-01', '2010-01-09', '2010-01-17', '2010-01-25', '2010-02-02', '2010-02-10', '2010-02-18', '2010-02-26', '2010-03-06', '2010-03-14', '2010-03-22', '2010-03-30', '2010-04-07', '2010-04-15', '2010-04-23', '2010-05-01', '2010-05-09', '2010-05-17', '2010-05-25', '2010-06-02', '2010-06-10', '2010-06-18', '2010-06-26', '2010-07-04', '2010-07-12', '2010-07-20', '2010-07-28', '2010-08-05', '2010-08-13', '2010-08-21', '2010-08-29', '2010-09-06', '2010-09-14', '2010-09-22', '2010-09-30', '2010-10-08', '2010-10-16', '2010-10-24', '2010-11-01', '2010-11-09', '2010-11-17', '2010-11-25', '2010-12-03', '2010-12-11', '2010-12-19', '2010-12-27', '2011-01-01', '2011-01-09', '2011-01-17', '2011-01-25', '2011-02-02', '2011-02-10', '2011-02-18', '2011-02-26', '2011-03-06', '2011-03-14', '2011-03-22', '2011-03-30', '2011-04-07', '2011-04-15', '2011-04-23', '2011-05-01', '2011-05-09', '2011-05-17', '2011-05-25', '2011-06-02', '2011-06-10', '2011-06-18', '2011-06-26', '2011-07-04', '2011-07-12', '2011-07-20', '2011-07-28', '2011-08-05', '2011-08-13', '2011-08-21', '2011-08-29', '2011-09-06', '2011-09-14', '2011-09-22', '2011-09-30', '2011-10-08', '2011-10-16', '2011-10-24', '2011-11-01', '2011-11-09', '2012-01-01', '2012-01-09', '2012-01-17', '2012-01-25', '2012-02-02', '2012-02-10', '2012-02-18', '2012-02-26', '2012-03-05', '2012-03-13', '2012-03-21', '2012-03-29', '2012-04-06', '2012-04-14', '2012-04-22', '2012-04-30', '2012-05-08', '2012-05-16', '2012-05-24', '2012-06-01', '2012-06-09', '2012-06-17', '2012-06-25', '2012-07-03', '2012-07-11', '2012-07-19', '2012-07-27', '2012-08-04', '2012-08-12', '2012-08-20', '2012-08-28', '2012-09-05', '2012-09-13', '2012-09-21', '2012-09-29', '2012-10-07', '2012-10-15', '2012-10-23', '2012-10-31', '2012-11-08', '2012-11-16', '2012-11-24', '2012-12-02', '2013-01-01', '2013-01-09', '2013-01-17', '2013-01-25', '2013-02-02', '2013-02-10', '2013-02-18', '2013-02-26', '2013-03-06', '2013-03-14', '2013-03-22', '2013-03-30', '2013-04-07', '2013-04-15', '2013-04-23', '2013-05-01', '2013-05-09', '2013-05-17', '2013-05-25', '2013-06-02', '2013-06-10', '2013-06-18', '2013-06-26', '2013-07-04', '2013-07-12', '2013-07-20', '2013-07-28', '2013-08-05', '2013-08-13', '2013-08-21', '2013-08-29', '2013-09-06', '2013-09-14', '2013-09-22', '2013-09-30', '2013-10-08', '2013-10-16', '2013-10-24', '2013-11-01', '2013-11-09', '2013-11-17', '2013-11-25', '2013-12-03', '2013-12-11', '2013-12-19', '2014-01-01', '2014-01-09', '2014-01-17', '2014-01-25', '2014-02-02', '2014-02-10', '2014-02-18', '2014-02-26', '2014-03-06', '2014-03-14', '2014-03-22', '2014-03-30', '2014-04-07', '2014-04-15', '2014-04-23', '2014-05-01', '2014-05-09', '2014-05-17', '2014-05-25', '2014-06-02', '2014-06-10', '2014-06-18', '2014-06-26', '2014-07-04', '2014-07-12', '2014-07-20', '2014-07-28', '2014-08-05', '2014-08-13', '2014-08-21', '2014-08-29', '2014-09-06', '2014-09-14', '2014-09-22', '2014-09-30', '2014-10-08', '2014-10-16', '2014-10-24', '2014-11-01', '2014-11-09', '2014-11-17', '2014-11-25', '2014-12-03', '2014-12-11', '2014-12-19', '2015-01-01', '2015-01-09', '2015-01-17', '2015-01-25', '2015-02-02', '2015-02-10', '2015-02-18', '2015-02-26', '2015-03-06', '2015-03-14', '2015-03-22', '2015-03-30', '2015-04-07', '2015-04-15', '2015-04-23', '2015-05-01', '2015-05-09', '2015-05-17', '2015-05-25', '2015-06-02', '2015-06-10', '2015-06-18', '2015-06-26', '2015-07-04', '2015-07-12', '2015-07-20', '2015-07-28', '2015-08-05', '2015-08-13', '2015-08-21', '2015-08-29', '2015-09-06', '2015-09-14', '2015-09-22', '2015-09-30', '2015-10-08', '2015-10-16', '2015-10-24', '2015-11-01', '2016-01-01', '2016-01-09', '2016-01-17', '2016-01-25', '2016-02-02', '2016-02-10', '2016-02-18', '2016-02-26', '2016-03-05', '2016-03-13', '2016-03-21', '2016-03-29', '2016-04-06', '2016-04-14', '2016-04-22', '2016-04-30', '2016-05-08', '2016-05-16', '2016-05-24', '2016-06-01', '2016-06-09', '2016-06-17', '2016-06-25', '2016-07-03', '2016-07-11', '2016-07-19', '2016-07-27', '2016-08-04', '2016-08-12', '2016-08-20', '2016-08-28', '2016-09-05', '2016-09-13', '2016-09-21', '2016-09-29', '2016-10-07', '2016-10-15', '2016-10-23', '2016-10-31', '2016-11-08', '2016-11-16', '2016-11-24', '2016-12-02', '2016-12-10', '2016-12-18', '2016-12-26', '2017-01-01', '2017-01-09', '2017-01-17', '2017-01-25', '2017-02-02', '2017-02-10', '2017-02-18', '2017-02-26', '2017-03-06', '2017-03-22', '2017-03-30', '2017-04-07', '2017-04-15', '2017-04-23', '2017-05-01', '2017-05-09', '2017-05-17', '2017-05-25', '2017-06-02', '2017-06-10', '2017-06-18', '2017-06-26', '2017-07-04', '2017-07-12', '2017-07-20', '2017-07-28', '2017-08-05', '2017-08-13', '2017-08-21', '2017-08-29', '2017-09-06', '2017-09-14', '2017-09-22', '2017-09-30', '2017-10-08', '2017-10-16', '2017-10-24', '2017-11-01', '2017-11-09', '2017-11-17', '2017-11-25'];
    if (periods.length==0) { // This means there are no tiles available, so create a dummy layer.
        var newLayer = new OpenLayers.Layer.TMS("Fractional Cover (FC)", "",
            { type: 'png', getURL:overlay_getTileURL, alpha:true, 
              isBaseLayer:false, queryId:"FC",
              baseUrl:"",title:"Fractional Cover (FC)",
              periods:periods,periodLength:8,
              legendUrl:"http://ec2-54-197-48-121.compute-1.amazonaws.com/dgw//irrig/legend?cmap=jet&amp;amp;vmin=0&amp;amp;vmax=1&amp;amp;tick_format=1.1f&amp;amp;label=Fractional%20Cover(%)", 
              visibility:false,
              serverZoomIndices: [ ],
              resolutions: []
        });
    } else {
        var newLayer = new OpenLayers.Layer.TMS("Fractional Cover (FC)", "http://ecocast.arc.nasa.gov/gi/sfdb.gi?CA30M_L5L7_Fc/"+periods[periods.length-1]+"/",
            { type: 'png', getURL:overlay_getTileURL, alpha:true, 
              isBaseLayer:false, queryId:"FC",
              baseUrl:"http://ecocast.arc.nasa.gov/gi/sfdb.gi?CA30M_L5L7_Fc/",title:"Fractional Cover (FC)",
              periods:periods,periodLength:8,
              legendUrl:"http://ec2-54-197-48-121.compute-1.amazonaws.com/dgw//irrig/legend?cmap=jet&amp;amp;vmin=0&amp;amp;vmax=1&amp;amp;tick_format=1.1f&amp;amp;label=Fractional%20Cover(%)", 
              visibility:false,
              resolutions: [  4891.9698095703125,
                              2445.9849047851562, 1222.9924523925781, 611.4962261962891,
                              305.74811309814453, 152.87405654907226, 76.43702827453613,
                              38.218514137268066, 19.109257068634033, 9.554628534317017,
                              4.777314267158508, 2.388657133579254, 1.194328566789627,
                              0.5971642833948135],
              serverResolutions: [4891.9698095703125, 2445.9849047851562,
                                1222.9924523925781, 611.4962261962891,
                                305.74811309814453, 152.87405654907226,
                                76.43702827453613, 76.43702827453613,
                              38.218514137268066, 19.109257068634033//, 9.554628534317017,
                              //4.777314267158508
                              ],
              serverZoomIndices: [ 5, 6, 7, 8, 9, 10, 11, 12, 13 ]
        });
    }
    map.addLayer(newLayer);
     
    
    var periods=['2010-01-01', '2010-01-09', '2010-01-17', '2010-01-25', '2010-02-02', '2010-02-10', '2010-02-18', '2010-02-26', '2010-03-06', '2010-03-14', '2010-03-22', '2010-03-30', '2010-04-07', '2010-04-15', '2010-04-23', '2010-05-01', '2010-05-09', '2010-05-17', '2010-05-25', '2010-06-02', '2010-06-10', '2010-06-18', '2010-06-26', '2010-07-04', '2010-07-12', '2010-07-20', '2010-07-28', '2010-08-05', '2010-08-13', '2010-08-21', '2010-08-29', '2010-09-06', '2010-09-14', '2010-09-22', '2010-09-30', '2010-10-08', '2010-10-16', '2010-10-24', '2010-11-01', '2010-11-09', '2010-11-17', '2010-11-25', '2010-12-03', '2010-12-11', '2010-12-19', '2010-12-27', '2011-01-01', '2011-01-09', '2011-01-17', '2011-01-25', '2011-02-02', '2011-02-10', '2011-02-18', '2011-02-26', '2011-03-06', '2011-03-14', '2011-03-22', '2011-03-30', '2011-04-07', '2011-04-15', '2011-04-23', '2011-05-01', '2011-05-09', '2011-05-17', '2011-05-25', '2011-06-02', '2011-06-10', '2011-06-18', '2011-06-26', '2011-07-04', '2011-07-12', '2011-07-20', '2011-07-28', '2011-08-05', '2011-08-13', '2011-08-21', '2011-08-29', '2011-09-06', '2011-09-14', '2011-09-22', '2011-09-30', '2011-10-08', '2011-10-16', '2011-10-24', '2011-11-01', '2011-11-09', '2012-01-01', '2012-01-09', '2012-01-17', '2012-01-25', '2012-02-02', '2012-02-10', '2012-02-18', '2012-02-26', '2012-03-05', '2012-03-13', '2012-03-21', '2012-03-29', '2012-04-06', '2012-04-14', '2012-04-22', '2012-04-30', '2012-05-08', '2012-05-16', '2012-05-24', '2012-06-01', '2012-06-09', '2012-06-17', '2012-06-25', '2012-07-03', '2012-07-11', '2012-07-19', '2012-07-27', '2012-08-04', '2012-08-12', '2012-08-20', '2012-08-28', '2012-09-05', '2012-09-13', '2012-09-21', '2012-09-29', '2012-10-07', '2012-10-15', '2012-10-23', '2012-10-31', '2012-11-08', '2012-11-16', '2012-11-24', '2012-12-02', '2013-01-01', '2013-01-09', '2013-01-17', '2013-01-25', '2013-02-02', '2013-02-10', '2013-02-18', '2013-02-26', '2013-03-06', '2013-03-14', '2013-03-22', '2013-03-30', '2013-04-07', '2013-04-15', '2013-04-23', '2013-05-01', '2013-05-09', '2013-05-17', '2013-05-25', '2013-06-02', '2013-06-10', '2013-06-18', '2013-06-26', '2013-07-04', '2013-07-12', '2013-07-20', '2013-07-28', '2013-08-05', '2013-08-13', '2013-08-21', '2013-08-29', '2013-09-06', '2013-09-14', '2013-09-22', '2013-09-30', '2013-10-08', '2013-10-16', '2013-10-24', '2013-11-01', '2013-11-09', '2013-11-17', '2013-11-25', '2013-12-03', '2013-12-11', '2013-12-19', '2014-01-01', '2014-01-09', '2014-01-17', '2014-01-25', '2014-02-02', '2014-02-10', '2014-02-18', '2014-02-26', '2014-03-06', '2014-03-14', '2014-03-22', '2014-03-30', '2014-04-07', '2014-04-15', '2014-04-23', '2014-05-01', '2014-05-09', '2014-05-17', '2014-05-25', '2014-06-02', '2014-06-10', '2014-06-18', '2014-06-26', '2014-07-04', '2014-07-12', '2014-07-20', '2014-07-28', '2014-08-05', '2014-08-13', '2014-08-21', '2014-08-29', '2014-09-06', '2014-09-14', '2014-09-22', '2014-09-30', '2014-10-08', '2014-10-16', '2014-10-24', '2014-11-01', '2014-11-09', '2014-11-17', '2014-11-25', '2014-12-03', '2014-12-11', '2014-12-19', '2015-01-01', '2015-01-09', '2015-01-17', '2015-01-25', '2015-02-02', '2015-02-10', '2015-02-18', '2015-02-26', '2015-03-06', '2015-03-14', '2015-03-22', '2015-03-30', '2015-04-07', '2015-04-15', '2015-04-23', '2015-05-01', '2015-05-09', '2015-05-17', '2015-05-25', '2015-06-02', '2015-06-10', '2015-06-18', '2015-06-26', '2015-07-04', '2015-07-12', '2015-07-20', '2015-07-28', '2015-08-05', '2015-08-13', '2015-08-21', '2015-08-29', '2015-09-06', '2015-09-14', '2015-09-22', '2015-09-30', '2015-10-08', '2015-10-16', '2015-10-24', '2015-11-01', '2016-01-01', '2016-01-09', '2016-01-17', '2016-01-25', '2016-02-02', '2016-02-10', '2016-02-18', '2016-02-26', '2016-03-05', '2016-03-13', '2016-03-21', '2016-03-29', '2016-04-06', '2016-04-14', '2016-04-22', '2016-04-30', '2016-05-08', '2016-05-16', '2016-05-24', '2016-06-01', '2016-06-09', '2016-06-17', '2016-06-25', '2016-07-03', '2016-07-11', '2016-07-19', '2016-07-27', '2016-08-04', '2016-08-12', '2016-08-20', '2016-08-28', '2016-09-05', '2016-09-13', '2016-09-21', '2016-10-15', '2016-10-23', '2016-11-16', '2016-11-24', '2016-12-02', '2016-12-10', '2016-12-18', '2016-12-26', '2017-01-01', '2017-01-09', '2017-01-17', '2017-01-25', '2017-02-02', '2017-02-10', '2017-02-18', '2017-02-26', '2017-03-06', '2017-03-22', '2017-03-30', '2017-04-07', '2017-04-15', '2017-04-23', '2017-05-01', '2017-05-09', '2017-05-17', '2017-05-25', '2017-06-02', '2017-06-10', '2017-06-18', '2017-06-26', '2017-07-04', '2017-07-12', '2017-07-20', '2017-07-28', '2017-08-05', '2017-08-13', '2017-08-21', '2017-08-29', '2017-09-06', '2017-09-14', '2017-09-22', '2017-09-30', '2017-10-08', '2017-10-16', '2017-10-24', '2017-11-01', '2017-11-09', '2017-11-17', '2017-11-25'];
    if (periods.length==0) { // This means there are no tiles available, so create a dummy layer.
        var newLayer = new OpenLayers.Layer.TMS("Crop coefficient (Kcb)", "",
            { type: 'png', getURL:overlay_getTileURL, alpha:true, 
              isBaseLayer:false, queryId:"Kcb",
              baseUrl:"",title:"Crop coefficient (Kcb)",
              periods:periods,periodLength:8,
              legendUrl:"http://ec2-54-197-48-121.compute-1.amazonaws.com/dgw//irrig/legend?cmap=kc&amp;vmin=0&amp;vmax=1.3&amp;tick_format=1.1f&amp;label=Kcb", 
              visibility:false,
              serverZoomIndices: [ ],
              resolutions: []
        });
    } else {
        var newLayer = new OpenLayers.Layer.TMS("Crop coefficient (Kcb)", "http://ecocast.arc.nasa.gov/gi/sfdb.gi?CA30M_L5L7_Kc/"+periods[periods.length-1]+"/",
            { type: 'png', getURL:overlay_getTileURL, alpha:true, 
              isBaseLayer:false, queryId:"Kcb",
              baseUrl:"http://ecocast.arc.nasa.gov/gi/sfdb.gi?CA30M_L5L7_Kc/",title:"Crop coefficient (Kcb)",
              periods:periods,periodLength:8,
              legendUrl:"http://ec2-54-197-48-121.compute-1.amazonaws.com/dgw//irrig/legend?cmap=kc&amp;vmin=0&amp;vmax=1.3&amp;tick_format=1.1f&amp;label=Kcb", 
              visibility:false,
              resolutions: [  4891.9698095703125,
                              2445.9849047851562, 1222.9924523925781, 611.4962261962891,
                              305.74811309814453, 152.87405654907226, 76.43702827453613,
                              38.218514137268066, 19.109257068634033, 9.554628534317017,
                              4.777314267158508, 2.388657133579254, 1.194328566789627,
                              0.5971642833948135],
              serverResolutions: [4891.9698095703125, 2445.9849047851562,
                                1222.9924523925781, 611.4962261962891,
                                305.74811309814453, 152.87405654907226,
                                76.43702827453613, 76.43702827453613,
                              38.218514137268066, 19.109257068634033//, 9.554628534317017,
                              //4.777314267158508
                              ],
              serverZoomIndices: [ 5, 6, 7, 8, 9, 10, 11, 12, 13 ]
        });
    }
    map.addLayer(newLayer);
     
    
    var periods=['2010-05-01', '2010-05-09', '2010-05-25', '2010-06-10', '2010-06-11', '2010-06-12', '2010-06-13', '2010-06-14', '2010-06-15', '2010-06-16', '2010-06-18', '2010-06-26', '2010-07-04', '2010-07-12', '2011-01-01', '2011-01-02', '2011-01-03', '2011-01-04', '2011-01-05', '2011-01-06', '2011-01-07', '2011-01-08', '2011-01-10', '2011-01-11', '2011-01-12', '2011-01-13', '2011-01-14', '2011-01-15', '2011-01-16', '2011-01-17', '2011-01-18', '2011-01-19', '2011-01-20', '2011-01-21', '2011-01-22', '2011-01-23', '2011-01-24', '2011-01-25', '2011-01-26', '2011-01-27', '2011-01-28', '2011-01-29', '2011-01-30', '2011-01-31', '2011-02-01', '2011-02-02', '2011-02-03', '2011-02-04', '2011-02-05', '2011-02-06', '2011-02-07', '2011-02-08', '2011-02-09', '2011-02-10', '2011-02-11', '2011-02-12', '2011-02-13', '2011-02-14', '2011-02-15', '2011-02-16', '2011-02-17', '2011-02-18', '2011-02-19', '2011-02-20', '2011-02-21', '2011-02-22', '2011-02-23', '2011-02-24', '2011-02-25', '2011-02-26', '2011-02-27', '2011-02-28', '2011-03-01', '2011-03-02', '2011-03-03', '2011-03-04', '2011-03-05', '2011-03-06', '2011-03-07', '2011-03-08', '2011-03-09', '2011-03-10', '2011-03-11', '2011-03-12', '2011-03-13', '2011-03-14', '2011-03-15', '2011-03-16', '2011-03-17', '2011-03-18', '2011-03-19', '2011-03-20', '2011-03-21', '2011-03-22', '2011-03-23', '2011-03-24', '2011-03-25', '2011-03-26', '2011-03-27', '2011-03-28', '2011-03-29', '2011-03-30', '2011-03-31', '2011-04-01', '2011-04-02', '2011-04-03', '2011-04-04', '2011-04-05', '2011-04-06', '2011-04-07', '2011-04-08', '2011-04-09', '2011-04-10', '2011-04-11', '2011-04-12', '2011-04-13', '2011-04-14', '2011-04-15', '2011-04-16', '2011-04-17', '2011-04-18', '2011-04-19', '2011-04-20', '2011-04-21', '2011-04-22', '2011-04-23', '2011-04-24', '2011-04-25', '2011-04-26', '2011-04-27', '2011-04-28', '2011-04-29', '2011-04-30', '2011-05-01', '2011-05-02', '2011-05-03', '2011-05-04', '2011-05-05', '2011-05-06', '2011-05-07', '2011-05-08', '2011-05-09', '2011-05-10', '2011-05-11', '2011-05-12', '2011-05-13', '2011-05-14', '2011-05-15', '2011-05-16', '2011-05-17', '2011-05-18', '2011-05-19', '2011-05-20', '2011-05-21', '2011-05-22', '2011-05-23', '2011-05-24', '2011-05-25', '2011-05-26', '2011-05-27', '2011-05-28', '2011-05-29', '2011-05-30', '2011-05-31', '2011-06-01', '2011-06-02', '2011-06-03', '2011-06-04', '2011-06-05', '2011-06-06', '2011-06-07', '2011-06-08', '2011-06-09', '2011-06-10', '2011-06-11', '2011-06-12', '2011-06-13', '2011-06-14', '2011-06-15', '2011-06-16', '2011-06-17', '2011-06-18', '2011-06-19', '2011-06-20', '2011-06-21', '2011-06-22', '2011-06-23', '2011-06-24', '2011-06-25', '2011-06-26', '2011-06-27', '2011-06-28', '2011-06-29', '2011-06-30', '2011-07-01', '2011-07-02', '2011-07-03', '2011-07-04', '2011-07-05', '2011-07-06', '2011-07-07', '2011-07-08', '2011-07-09', '2011-07-15', '2011-07-16', '2011-07-17', '2011-07-18', '2011-07-19', '2011-07-20', '2011-07-22', '2011-07-28', '2011-07-31', '2011-08-02', '2011-08-03', '2011-08-04', '2011-08-05', '2011-08-06', '2011-08-07', '2011-08-10', '2011-08-11', '2011-08-12', '2011-08-13', '2011-08-14', '2011-08-15', '2011-08-16', '2011-08-19', '2011-08-20', '2011-08-21', '2011-08-23', '2011-08-24', '2011-08-25', '2011-08-26', '2011-08-27', '2011-08-28', '2011-08-29', '2011-08-30', '2011-09-01', '2011-09-02', '2011-09-03', '2011-09-04', '2011-09-05', '2011-09-06', '2011-09-07', '2011-09-08', '2011-09-09', '2011-09-10', '2011-09-11', '2011-09-12', '2011-09-13', '2011-09-14', '2011-09-15', '2011-09-16', '2011-09-17', '2011-09-18', '2011-09-19', '2011-09-20', '2011-09-21', '2011-09-22', '2011-09-23', '2011-09-24', '2011-09-25', '2011-09-26', '2011-09-27', '2011-09-28', '2011-09-29', '2011-09-30', '2011-10-01', '2011-10-02', '2011-10-03', '2011-10-04', '2011-10-05', '2011-10-06', '2011-10-07', '2011-10-08', '2011-10-09', '2011-10-10', '2011-10-11', '2011-10-12', '2011-10-13', '2011-10-14', '2011-10-15', '2012-01-01', '2012-01-02', '2012-01-03', '2012-01-04', '2012-01-05', '2012-01-06', '2012-01-07', '2012-01-08', '2012-01-09', '2012-01-10', '2012-01-11', '2012-01-12', '2012-01-13', '2012-01-14', '2012-01-15', '2012-01-16', '2012-01-17', '2012-01-18', '2012-01-19', '2012-01-20', '2012-01-21', '2012-01-22', '2012-01-23', '2012-01-24', '2012-01-25', '2012-01-26', '2012-01-27', '2012-01-28', '2012-01-29', '2012-01-30', '2012-01-31', '2012-02-01', '2012-02-02', '2012-02-03', '2012-02-04', '2012-02-05', '2012-02-06', '2012-02-07', '2012-02-08', '2012-02-09', '2012-02-10', '2012-02-11', '2012-02-12', '2012-02-13', '2012-02-14', '2012-02-15', '2012-02-16', '2012-02-17', '2012-02-18', '2012-02-19', '2012-02-20', '2012-02-21', '2012-02-22', '2012-02-23', '2012-02-24', '2012-02-25', '2012-02-26', '2012-02-27', '2012-02-28', '2012-02-29', '2012-03-01', '2012-03-02', '2012-03-03', '2012-03-04', '2012-03-05', '2012-03-06', '2012-03-07', '2012-03-08', '2012-03-09', '2012-03-10', '2012-03-11', '2012-03-12', '2012-03-13', '2012-03-14', '2012-03-15', '2012-03-16', '2012-03-17', '2012-03-18', '2012-03-19', '2012-03-20', '2012-03-21', '2012-03-23', '2012-03-24', '2012-03-25', '2012-03-26', '2012-03-27', '2012-03-28', '2012-03-29', '2012-03-30', '2012-03-31', '2012-04-01', '2012-04-02', '2012-04-03', '2012-04-04', '2012-04-05', '2012-04-06', '2012-04-07', '2012-04-08', '2012-04-09', '2012-04-10', '2012-04-11', '2012-04-12', '2012-04-13', '2012-04-14', '2012-04-15', '2012-04-16', '2012-04-17', '2012-04-18', '2012-04-19', '2012-04-20', '2012-04-21', '2012-04-22', '2012-04-23', '2012-04-24', '2012-04-25', '2012-04-26', '2012-04-27', '2012-04-28', '2012-04-29', '2012-04-30', '2012-05-01', '2012-05-02', '2012-05-03', '2012-05-04', '2012-05-05', '2012-05-06', '2012-05-07', '2012-05-08', '2012-05-09', '2012-05-10', '2012-05-11', '2012-05-12', '2012-05-13', '2012-05-14', '2012-05-15', '2012-05-16', '2012-05-17', '2012-05-18', '2012-05-19', '2012-05-20', '2012-05-21', '2012-05-22', '2012-05-23', '2012-05-24', '2012-05-25', '2012-05-26', '2012-05-27', '2012-05-28', '2012-05-29', '2012-05-30', '2012-05-31', '2012-06-01', '2012-06-02', '2012-06-03', '2012-06-04', '2012-06-05', '2012-06-06', '2012-06-07', '2012-06-08', '2012-06-09', '2012-06-10', '2012-06-11', '2012-06-12', '2012-06-13', '2012-06-14', '2012-06-15', '2012-06-16', '2012-06-17', '2012-06-18', '2012-06-19', '2012-06-20', '2012-06-21', '2012-06-22', '2012-06-23', '2012-06-24', '2012-06-25', '2012-06-26', '2012-06-27', '2012-06-28', '2012-06-29', '2012-06-30', '2012-07-01', '2012-07-02', '2012-07-03', '2012-07-04', '2012-07-05', '2012-07-06', '2012-07-07', '2012-07-08', '2012-07-09', '2012-07-10', '2012-07-11', '2012-07-12', '2012-07-13', '2012-07-14', '2012-07-15', '2012-07-16', '2012-07-17', '2012-07-18', '2012-07-19', '2012-07-20', '2012-07-21', '2012-07-22', '2012-07-23', '2012-07-24', '2012-07-25', '2012-07-26', '2012-07-27', '2012-07-28', '2012-07-29', '2012-07-30', '2012-07-31', '2012-08-01', '2012-08-02', '2012-08-03', '2012-08-04', '2012-08-05', '2012-08-06', '2012-08-07', '2012-08-08', '2012-08-09', '2012-08-10', '2012-08-11', '2012-08-12', '2012-08-13', '2012-08-14', '2012-08-15', '2012-08-16', '2012-08-17', '2012-08-18', '2012-08-19', '2012-08-20', '2012-08-21', '2012-08-22', '2012-08-23', '2012-08-24', '2012-08-25', '2012-08-26', '2012-08-28', '2012-08-29', '2012-08-30', '2012-08-31', '2012-09-01', '2012-09-02', '2012-09-03', '2012-09-04', '2012-09-05', '2012-09-06', '2012-09-07', '2012-09-08', '2012-09-09', '2012-09-10', '2012-09-11', '2012-09-12', '2012-09-13', '2012-09-14', '2012-09-15', '2012-09-16', '2012-09-17', '2012-09-18', '2012-09-19', '2012-09-20', '2012-09-21', '2012-09-22', '2012-09-23', '2012-09-24', '2012-09-25', '2012-09-26', '2012-09-27', '2012-09-28', '2012-09-29', '2012-09-30', '2012-10-01', '2012-10-02', '2012-10-03', '2012-10-04', '2012-10-05', '2012-10-06', '2012-10-07', '2012-10-08', '2012-10-09', '2012-10-10', '2012-10-11', '2012-10-12', '2012-10-13', '2012-10-14', '2012-10-15', '2012-10-16', '2012-10-17', '2012-10-18', '2012-10-19', '2012-10-20', '2012-10-21', '2012-10-22', '2012-10-23', '2012-10-24', '2012-10-25', '2012-10-26', '2012-10-27', '2012-10-28', '2012-10-29', '2012-10-30', '2012-10-31', '2012-11-01', '2012-11-02', '2012-11-03', '2012-11-04', '2012-11-05', '2012-11-06', '2012-11-07', '2012-11-08', '2012-11-09', '2012-11-10', '2012-11-11', '2012-11-12', '2012-11-13', '2012-11-14', '2012-11-15', '2012-11-16', '2012-11-17', '2012-11-18', '2012-11-19', '2012-11-20', '2012-11-21', '2012-11-22', '2012-11-23', '2012-11-24', '2012-11-25', '2012-11-26', '2012-11-27', '2012-11-28', '2012-11-29', '2012-11-30', '2012-12-01', '2012-12-02', '2012-12-03', '2012-12-04', '2012-12-05', '2012-12-06', '2012-12-07', '2012-12-08', '2012-12-09', '2013-01-01', '2013-01-02', '2013-01-03', '2013-01-04', '2013-01-05', '2013-01-06', '2013-01-07', '2013-01-08', '2013-01-09', '2013-01-10', '2013-01-11', '2013-01-12', '2013-01-13', '2013-01-14', '2013-01-15', '2013-01-16', '2013-01-17', '2013-01-18', '2013-01-19', '2013-01-20', '2013-01-21', '2013-01-22', '2013-01-23', '2013-01-24', '2013-01-25', '2013-01-26', '2013-01-27', '2013-01-28', '2013-01-29', '2013-01-30', '2013-01-31', '2013-02-01', '2013-02-02', '2013-02-03', '2013-02-04', '2013-02-05', '2013-02-06', '2013-02-07', '2013-02-08', '2013-02-09', '2013-02-10', '2013-02-11', '2013-02-12', '2013-02-13', '2013-02-14', '2013-02-15', '2013-02-16', '2013-02-17', '2013-02-18', '2013-02-19', '2013-02-20', '2013-02-21', '2013-02-22', '2013-02-23', '2013-02-24', '2013-02-25', '2013-02-26', '2013-02-27', '2013-02-28', '2013-03-01', '2013-03-02', '2013-03-03', '2013-03-04', '2013-03-05', '2013-03-06', '2013-03-07', '2013-03-08', '2013-03-09', '2013-03-10', '2013-03-11', '2013-03-13', '2013-03-14', '2013-03-15', '2013-03-16', '2013-03-17', '2013-03-18', '2013-03-19', '2013-03-20', '2013-03-21', '2013-03-22', '2013-03-23', '2013-03-24', '2013-03-25', '2013-03-26', '2013-03-27', '2013-03-28', '2013-03-29', '2013-03-30', '2013-03-31', '2013-04-01', '2013-04-02', '2013-04-03', '2013-04-04', '2013-04-05', '2013-04-06', '2013-04-07', '2013-04-08', '2013-04-09', '2013-04-10', '2013-04-11', '2013-04-12', '2013-04-13', '2013-04-14', '2013-04-15', '2013-04-16', '2013-04-17', '2013-04-18', '2013-04-19', '2013-04-20', '2013-04-21', '2013-04-22', '2013-04-23', '2013-04-24', '2013-04-25', '2013-04-26', '2013-04-27', '2013-04-28', '2013-04-29', '2013-04-30', '2013-05-01', '2013-05-02', '2013-05-03', '2013-05-04', '2013-05-05', '2013-05-06', '2013-05-07', '2013-05-08', '2013-05-09', '2013-05-10', '2013-05-11', '2013-05-12', '2013-05-13', '2013-05-14', '2013-05-15', '2013-05-16', '2013-05-17', '2013-05-18', '2013-05-19', '2013-05-20', '2013-05-21', '2013-05-22', '2013-05-23', '2013-05-24', '2013-05-25', '2013-05-26', '2013-05-27', '2013-05-28', '2013-05-29', '2013-05-30', '2013-05-31', '2013-06-01', '2013-06-02', '2013-06-03', '2013-06-04', '2013-06-05', '2013-06-06', '2013-06-07', '2013-06-08', '2013-06-09', '2013-06-10', '2013-06-11', '2013-06-12', '2013-06-13', '2013-06-14', '2013-06-15', '2013-06-16', '2013-06-17', '2013-06-18', '2013-06-19', '2013-06-20', '2013-06-21', '2013-06-22', '2013-06-23', '2013-06-24', '2013-06-25', '2013-06-26', '2013-06-27', '2013-06-28', '2013-06-29', '2013-06-30', '2013-07-01', '2013-07-02', '2013-07-03', '2013-07-04', '2013-07-05', '2013-07-06', '2013-07-07', '2013-07-08', '2013-07-09', '2013-07-10', '2013-07-11', '2013-07-12', '2013-07-13', '2013-07-14', '2013-07-15', '2013-07-16', '2013-07-17', '2013-07-18', '2013-07-19', '2013-07-20', '2013-07-21', '2013-07-22', '2013-07-23', '2013-07-24', '2013-07-25', '2013-07-26', '2013-07-27', '2013-07-28', '2013-07-29', '2013-07-30', '2013-07-31', '2013-08-01', '2013-08-02', '2013-08-03', '2013-08-04', '2013-08-05', '2013-08-06', '2013-08-07', '2013-08-08', '2013-08-09', '2013-08-10', '2013-08-11', '2013-08-12', '2013-08-13', '2013-08-14', '2013-08-15', '2013-08-16', '2013-08-17', '2013-08-18', '2013-08-19', '2013-08-20', '2013-08-21', '2013-08-22', '2013-08-23', '2013-08-24', '2013-08-25', '2013-08-26', '2013-08-27', '2013-08-28', '2013-08-29', '2013-08-30', '2013-08-31', '2013-09-01', '2013-09-02', '2013-09-03', '2013-09-04', '2013-09-05', '2013-09-06', '2013-09-07', '2013-09-08', '2013-09-09', '2013-09-10', '2013-09-11', '2013-09-12', '2013-09-13', '2013-09-14', '2013-09-15', '2013-09-16', '2013-09-17', '2013-09-18', '2013-09-19', '2013-09-20', '2013-09-21', '2013-09-22', '2013-09-23', '2013-09-24', '2013-09-25', '2013-09-26', '2013-09-27', '2013-09-28', '2013-09-29', '2013-09-30', '2013-10-01', '2013-10-02', '2013-10-03', '2013-10-04', '2013-10-05', '2013-10-06', '2013-10-07', '2013-10-08', '2013-10-09', '2013-10-10', '2013-10-11', '2013-10-12', '2013-10-13', '2013-10-14', '2013-10-15', '2013-10-16', '2013-10-17', '2013-10-18', '2013-10-19', '2013-10-20', '2013-10-21', '2013-10-22', '2013-10-23', '2013-10-24', '2013-10-25', '2013-10-26', '2013-10-27', '2013-10-28', '2013-10-29', '2013-10-30', '2013-10-31', '2013-11-01', '2013-11-02', '2013-11-03', '2013-11-04', '2013-11-05', '2013-11-06', '2013-11-07', '2013-11-08', '2013-11-09', '2013-11-10', '2013-11-11', '2013-11-12', '2013-11-13', '2013-11-14', '2013-11-15', '2013-11-16', '2013-11-17', '2013-11-18', '2013-11-19', '2013-11-20', '2013-11-21', '2013-11-22', '2013-11-23', '2013-11-24', '2013-11-25', '2013-11-26', '2013-11-27', '2013-11-28', '2013-11-29', '2013-11-30', '2013-12-01', '2013-12-02', '2013-12-03', '2013-12-04', '2013-12-05', '2013-12-06', '2013-12-07', '2013-12-08', '2013-12-09', '2013-12-10', '2013-12-11', '2013-12-12', '2013-12-13', '2013-12-14', '2013-12-15', '2013-12-16', '2013-12-17', '2013-12-18', '2013-12-19', '2013-12-20', '2013-12-21', '2013-12-22', '2013-12-23', '2013-12-24', '2013-12-25', '2013-12-26', '2014-01-01', '2014-01-02', '2014-01-03', '2014-01-04', '2014-01-05', '2014-01-06', '2014-01-07', '2014-01-08', '2014-01-09', '2014-01-10', '2014-01-11', '2014-01-12', '2014-01-13', '2014-01-14', '2014-01-15', '2014-01-16', '2014-01-17', '2014-01-18', '2014-01-19', '2014-01-20', '2014-01-21', '2014-01-22', '2014-01-23', '2014-01-24', '2014-01-25', '2014-01-26', '2014-01-27', '2014-01-28', '2014-01-29', '2014-01-30', '2014-01-31', '2014-02-01', '2014-02-02', '2014-02-03', '2014-02-04', '2014-02-05', '2014-02-06', '2014-02-07', '2014-02-08', '2014-02-09', '2014-02-10', '2014-02-11', '2014-02-12', '2014-02-13', '2014-02-14', '2014-02-15', '2014-02-16', '2014-02-17', '2014-02-18', '2014-02-19', '2014-02-20', '2014-02-21', '2014-02-22', '2014-02-23', '2014-02-24', '2014-02-25', '2014-02-26', '2014-02-27', '2014-02-28', '2014-03-01', '2014-03-02', '2014-03-03', '2014-03-04', '2014-03-05', '2014-03-06', '2014-03-07', '2014-03-08', '2014-03-09', '2014-03-10', '2014-03-11', '2014-03-12', '2014-03-13', '2014-03-14', '2014-03-15', '2014-03-16', '2014-03-17', '2014-03-18', '2014-03-19', '2014-03-20', '2014-03-21', '2014-03-22', '2014-03-23', '2014-03-24', '2014-03-25', '2014-03-26', '2014-03-27', '2014-03-28', '2014-03-29', '2014-03-30', '2014-03-31', '2014-04-01', '2014-04-02', '2014-04-03', '2014-04-04', '2014-04-05', '2014-04-06', '2014-04-07', '2014-04-08', '2014-04-09', '2014-04-10', '2014-04-11', '2014-04-12', '2014-04-13', '2014-04-14', '2014-04-15', '2014-04-16', '2014-04-17', '2014-04-18', '2014-04-19', '2014-04-20', '2014-04-21', '2014-04-22', '2014-04-23', '2014-04-24', '2014-04-25', '2014-04-26', '2014-04-27', '2014-04-28', '2014-04-29', '2014-04-30', '2014-05-01', '2014-05-02', '2014-05-03', '2014-05-04', '2014-05-05', '2014-05-06', '2014-05-07', '2014-05-08', '2014-05-09', '2014-05-10', '2014-05-11', '2014-05-12', '2014-05-13', '2014-05-14', '2014-05-15', '2014-05-16', '2014-05-17', '2014-05-18', '2014-05-19', '2014-05-20', '2014-05-21', '2014-05-22', '2014-05-23', '2014-05-24', '2014-05-25', '2014-05-26', '2014-05-27', '2014-05-28', '2014-05-29', '2014-05-30', '2014-05-31', '2014-06-01', '2014-06-02', '2014-06-03', '2014-06-04', '2014-06-05', '2014-06-06', '2014-06-07', '2014-06-08', '2014-06-09', '2014-06-10', '2014-06-11', '2014-06-12', '2014-06-13', '2014-06-14', '2014-06-15', '2014-06-16', '2014-06-17', '2014-06-18', '2014-06-19', '2014-06-20', '2014-06-21', '2014-06-22', '2014-06-23', '2014-06-24', '2014-06-25', '2014-06-26', '2014-06-27', '2014-06-28', '2014-06-29', '2014-06-30', '2014-07-01', '2014-07-02', '2014-07-03', '2014-07-04', '2014-07-05', '2014-07-06', '2014-07-07', '2014-07-08', '2014-07-09', '2014-07-10', '2014-07-11', '2014-07-12', '2014-07-13', '2014-07-14', '2014-07-15', '2014-07-16', '2014-07-17', '2014-07-18', '2014-07-19', '2014-07-20', '2014-07-21', '2014-07-22', '2014-07-23', '2014-07-24', '2014-07-25', '2014-07-26', '2014-07-27', '2014-07-28', '2014-07-29', '2014-07-30', '2014-07-31', '2014-08-01', '2014-08-02', '2014-08-03', '2014-08-04', '2014-08-05', '2014-08-06', '2014-08-07', '2014-08-08', '2014-08-09', '2014-08-10', '2014-08-11', '2014-08-12', '2014-08-13', '2014-08-14', '2014-08-15', '2014-08-16', '2014-08-17', '2014-08-18', '2014-08-19', '2014-08-20', '2014-08-21', '2014-08-22', '2014-08-23', '2014-08-24', '2014-08-25', '2014-08-26', '2014-08-27', '2014-08-28', '2014-08-29', '2014-08-30', '2014-08-31', '2014-09-01', '2014-09-02', '2014-09-03', '2014-09-04', '2014-09-05', '2014-09-06', '2014-09-07', '2014-09-08', '2014-09-09', '2014-09-10', '2014-09-11', '2014-09-12', '2014-09-13', '2014-09-14', '2014-09-15', '2014-09-16', '2014-09-17', '2014-09-18', '2014-09-19', '2014-09-20', '2014-09-21', '2014-09-22', '2014-09-23', '2014-09-24', '2014-09-25', '2014-09-26', '2014-09-27', '2014-09-28', '2014-09-29', '2014-09-30', '2014-10-01', '2014-10-02', '2014-10-03', '2014-10-04', '2014-10-05', '2014-10-06', '2014-10-07', '2014-10-08', '2014-10-09', '2014-10-10', '2014-10-11', '2014-10-12', '2014-10-13', '2014-10-14', '2014-10-15', '2014-10-16', '2014-10-17', '2014-10-18', '2014-10-19', '2014-10-20', '2014-10-21', '2014-10-22', '2014-10-23', '2014-10-24', '2014-10-25', '2014-10-26', '2014-10-27', '2014-10-28', '2014-10-29', '2014-10-30', '2014-10-31', '2014-11-01', '2014-11-02', '2014-11-03', '2014-11-04', '2014-11-05', '2014-11-06', '2014-11-07', '2014-11-08', '2014-11-09', '2014-11-10', '2014-11-11', '2014-11-12', '2014-11-13', '2014-11-14', '2014-11-15', '2014-11-16', '2014-11-17', '2014-11-18', '2014-11-19', '2014-11-20', '2014-11-21', '2014-11-22', '2014-11-23', '2014-11-24', '2014-11-25', '2014-11-26', '2014-11-27', '2014-11-28', '2014-11-29', '2014-11-30', '2014-12-01', '2014-12-02', '2014-12-03', '2014-12-04', '2014-12-05', '2014-12-06', '2014-12-07', '2014-12-08', '2014-12-09', '2014-12-10', '2014-12-11', '2014-12-12', '2014-12-13', '2014-12-14', '2014-12-15', '2014-12-16', '2014-12-17', '2014-12-18', '2014-12-19', '2014-12-20', '2014-12-21', '2014-12-22', '2014-12-23', '2014-12-24', '2014-12-25', '2014-12-26', '2015-01-01', '2015-01-02', '2015-01-03', '2015-01-04', '2015-01-05', '2015-01-06', '2015-01-07', '2015-01-09', '2015-01-10', '2015-01-11', '2015-01-12', '2015-01-13', '2015-01-14', '2015-01-15', '2015-01-16', '2015-01-17', '2015-01-18', '2015-01-19', '2015-01-20', '2015-01-21', '2015-01-22', '2015-01-23', '2015-01-24', '2015-01-25', '2015-01-26', '2015-01-27', '2015-01-28', '2015-01-29', '2015-01-30', '2015-01-31', '2015-02-01', '2015-02-02', '2015-02-03', '2015-02-04', '2015-02-05', '2015-02-06', '2015-02-07', '2015-02-08', '2015-02-09', '2015-02-10', '2015-02-11', '2015-02-12', '2015-02-13', '2015-02-14', '2015-02-15', '2015-02-16', '2015-02-17', '2015-02-18', '2015-02-19', '2015-02-20', '2015-02-21', '2015-02-22', '2015-02-23', '2015-02-24', '2015-02-25', '2015-02-26', '2015-02-27', '2015-02-28', '2015-03-01', '2015-03-02', '2015-03-03', '2015-03-04', '2015-03-05', '2015-03-06', '2015-03-07', '2015-03-08', '2015-03-09', '2015-03-10', '2015-03-11', '2015-03-12', '2015-03-13', '2015-03-14', '2015-03-15', '2015-03-16', '2015-03-17', '2015-03-18', '2015-03-19', '2015-03-20', '2015-03-21', '2015-03-22', '2015-03-23', '2015-03-24', '2015-03-25', '2015-03-26', '2015-03-27', '2015-03-28', '2015-03-29', '2015-03-30', '2015-03-31', '2015-04-01', '2015-04-02', '2015-04-03', '2015-04-04', '2015-04-05', '2015-04-06', '2015-04-07', '2015-04-08', '2015-04-09', '2015-04-10', '2015-04-11', '2015-04-12', '2015-04-13', '2015-04-14', '2015-04-15', '2015-04-16', '2015-04-17', '2015-04-18', '2015-04-19', '2015-04-20', '2015-04-21', '2015-04-22', '2015-04-23', '2015-04-24', '2015-04-25', '2015-04-26', '2015-04-27', '2015-04-28', '2015-04-29', '2015-04-30', '2015-05-01', '2015-05-02', '2015-05-03', '2015-05-04', '2015-05-05', '2015-05-06', '2015-05-07', '2015-05-08', '2015-05-09', '2015-05-10', '2015-05-11', '2015-05-12', '2015-05-13', '2015-05-14', '2015-05-15', '2015-05-16', '2015-05-17', '2015-05-18', '2015-05-19', '2015-05-20', '2015-05-21', '2015-05-22', '2015-05-23', '2015-05-24', '2015-05-25', '2015-05-26', '2015-05-27', '2015-05-28', '2015-05-29', '2015-05-30', '2015-05-31', '2015-06-01', '2015-06-02', '2015-06-03', '2015-06-04', '2015-06-05', '2015-06-06', '2015-06-07', '2015-06-08', '2015-06-09', '2015-06-10', '2015-06-11', '2015-06-12', '2015-06-13', '2015-06-14', '2015-06-15', '2015-06-16', '2015-06-17', '2015-06-18', '2015-06-19', '2015-06-20', '2015-06-21', '2015-06-22', '2015-06-23', '2015-06-24', '2015-06-25', '2015-06-26', '2015-06-27', '2015-06-28', '2015-06-29', '2015-06-30', '2015-07-01', '2015-07-02', '2015-07-03', '2015-07-04', '2015-07-05', '2015-07-06', '2015-07-07', '2015-07-08', '2015-07-09', '2015-07-10', '2015-07-11', '2015-07-12', '2015-07-13', '2015-07-14', '2015-07-15', '2015-07-16', '2015-07-17', '2015-07-18', '2015-07-19', '2015-07-20', '2015-07-21', '2015-07-22', '2015-07-23', '2015-07-24', '2015-07-25', '2015-07-26', '2015-07-27', '2015-07-28', '2015-07-29', '2015-07-30', '2015-07-31', '2015-08-01', '2015-08-02', '2015-08-03', '2015-08-04', '2015-08-05', '2015-08-06', '2015-08-07', '2015-08-08', '2015-08-09', '2015-08-10', '2015-08-11', '2015-08-12', '2015-08-13', '2015-08-14', '2015-08-15', '2015-08-16', '2015-08-17', '2015-08-18', '2015-08-19', '2015-08-20', '2015-08-21', '2015-08-22', '2015-08-23', '2015-08-24', '2015-08-25', '2015-08-26', '2015-08-27', '2015-08-28', '2015-08-29', '2015-08-30', '2015-08-31', '2015-09-01', '2015-09-02', '2015-09-03', '2015-09-04', '2015-09-05', '2015-09-06', '2015-09-07', '2015-09-08', '2015-09-09', '2015-09-10', '2015-09-11', '2015-09-12', '2015-09-13', '2015-09-14', '2015-09-15', '2015-09-16', '2015-09-17', '2015-09-18', '2015-09-19', '2015-09-20', '2015-09-21', '2015-09-22', '2015-09-23', '2015-09-24', '2015-09-25', '2015-09-26', '2015-09-27', '2015-09-28', '2015-09-29', '2015-09-30', '2015-10-01', '2015-10-02', '2015-10-03', '2015-10-04', '2015-10-05', '2015-10-06', '2015-10-07', '2015-10-08', '2015-10-09', '2015-10-10', '2015-10-11', '2015-10-12', '2015-10-13', '2015-10-15', '2015-10-16', '2015-10-17', '2015-10-18', '2015-10-19', '2015-10-20', '2015-10-21', '2015-10-22', '2015-10-24', '2015-10-25', '2015-10-26', '2015-10-27', '2015-10-28', '2015-10-29', '2015-10-30', '2015-10-31', '2015-11-01', '2015-11-02', '2015-11-03', '2015-11-04', '2015-11-05', '2015-11-06', '2015-11-07', '2015-11-08', '2016-01-01', '2016-01-02', '2016-01-03', '2016-01-04', '2016-01-05', '2016-01-06', '2016-01-07', '2016-01-08', '2016-01-09', '2016-01-10', '2016-01-11', '2016-01-12', '2016-01-13', '2016-01-14', '2016-01-15', '2016-01-16', '2016-01-17', '2016-01-18', '2016-01-19', '2016-01-20', '2016-01-21', '2016-01-22', '2016-01-23', '2016-01-24', '2016-01-25', '2016-01-26', '2016-01-27', '2016-01-28', '2016-01-29', '2016-01-30', '2016-01-31', '2016-02-01', '2016-02-02', '2016-02-03', '2016-02-04', '2016-02-05', '2016-02-06', '2016-02-07', '2016-02-08', '2016-02-09', '2016-02-10', '2016-02-11', '2016-02-12', '2016-02-13', '2016-02-14', '2016-02-15', '2016-02-16', '2016-02-17', '2016-02-18', '2016-02-19', '2016-02-20', '2016-02-21', '2016-02-22', '2016-02-23', '2016-02-24', '2016-02-25', '2016-02-26', '2016-02-27', '2016-02-28', '2016-02-29', '2016-03-01', '2016-03-02', '2016-03-03', '2016-03-04', '2016-03-05', '2016-03-06', '2016-03-07', '2016-03-08', '2016-03-09', '2016-03-10', '2016-03-11', '2016-03-12', '2016-03-13', '2016-03-14', '2016-03-15', '2016-03-16', '2016-03-17', '2016-03-18', '2016-03-19', '2016-03-20', '2016-03-21', '2016-03-22', '2016-03-23', '2016-03-24', '2016-03-25', '2016-03-26', '2016-03-27', '2016-03-28', '2016-03-29', '2016-03-30', '2016-03-31', '2016-04-01', '2016-04-02', '2016-04-03', '2016-04-04', '2016-04-05', '2016-04-06', '2016-04-07', '2016-04-08', '2016-04-09', '2016-04-10', '2016-04-11', '2016-04-12', '2016-04-13', '2016-04-14', '2016-04-15', '2016-04-16', '2016-04-17', '2016-04-18', '2016-04-19', '2016-04-20', '2016-04-21', '2016-04-22', '2016-04-23', '2016-04-24', '2016-04-25', '2016-04-26', '2016-04-27', '2016-04-28', '2016-04-29', '2016-04-30', '2016-05-01', '2016-05-02', '2016-05-03', '2016-05-04', '2016-05-05', '2016-05-06', '2016-05-07', '2016-05-08', '2016-05-09', '2016-05-10', '2016-05-11', '2016-05-12', '2016-05-13', '2016-05-14', '2016-05-15', '2016-05-16', '2016-05-17', '2016-05-18', '2016-05-19', '2016-05-20', '2016-05-21', '2016-05-22', '2016-05-23', '2016-05-24', '2016-05-25', '2016-05-26', '2016-05-27', '2016-05-28', '2016-05-29', '2016-05-30', '2016-05-31', '2016-06-01', '2016-06-02', '2016-06-03', '2016-06-04', '2016-06-05', '2016-06-06', '2016-06-07', '2016-06-08', '2016-06-09', '2016-06-10', '2016-06-11', '2016-06-12', '2016-06-13', '2016-06-14', '2016-06-15', '2016-06-16', '2016-06-17', '2016-06-18', '2016-06-19', '2016-06-20', '2016-06-21', '2016-06-22', '2016-06-23', '2016-06-24', '2016-06-25', '2016-06-26', '2016-06-27', '2016-06-28', '2016-06-29', '2016-06-30', '2016-07-01', '2016-07-02', '2016-07-03', '2016-07-04', '2016-07-05', '2016-07-06', '2016-07-07', '2016-07-08', '2016-07-09', '2016-07-10', '2016-07-11', '2016-07-12', '2016-07-13', '2016-07-14', '2016-07-15', '2016-07-16', '2016-07-17', '2016-07-18', '2016-07-19', '2016-07-20', '2016-07-21', '2016-07-22', '2016-07-23', '2016-07-24', '2016-07-25', '2016-07-26', '2016-07-27', '2016-07-28', '2016-07-29', '2016-07-30', '2016-07-31', '2016-08-01', '2016-08-02', '2016-08-03', '2016-08-04', '2016-08-05', '2016-08-06', '2016-08-07', '2016-08-08', '2016-08-09', '2016-08-10', '2016-08-11', '2016-08-12', '2016-08-13', '2016-08-14', '2016-08-15', '2016-08-16', '2016-08-17', '2016-08-18', '2016-08-19', '2016-08-20', '2016-08-21', '2016-08-22', '2016-08-23', '2016-08-24', '2016-08-25', '2016-08-26', '2016-08-27', '2016-08-28', '2016-08-29', '2016-08-30', '2016-08-31', '2016-09-01', '2016-09-02', '2016-09-03', '2016-09-04', '2016-09-05', '2016-09-06', '2016-09-07', '2016-09-08', '2016-09-09', '2016-09-10', '2016-09-11', '2016-09-12', '2016-09-13', '2016-09-14', '2016-09-15', '2016-09-16', '2016-09-17', '2016-09-18', '2016-09-19', '2016-09-20', '2016-09-21', '2016-09-22', '2016-09-23', '2016-09-24', '2016-09-25', '2016-09-26', '2016-09-27', '2016-09-28', '2016-09-29', '2016-09-30', '2016-10-01', '2016-10-02', '2016-10-03', '2016-10-04', '2016-10-05', '2016-10-06', '2016-10-07', '2016-10-08', '2016-10-09', '2016-10-10', '2016-10-11', '2016-10-12', '2016-10-13', '2016-10-14', '2016-10-15', '2016-10-16', '2016-10-17', '2016-10-18', '2016-10-19', '2016-10-20', '2016-10-21', '2016-10-22', '2016-10-23', '2016-10-24', '2016-10-25', '2016-10-26', '2016-10-27', '2016-10-28', '2016-10-29', '2016-10-30', '2016-10-31', '2016-11-01', '2016-11-02', '2016-11-03', '2016-11-04', '2016-11-05', '2016-11-06', '2016-11-07', '2016-11-08', '2016-11-09', '2016-11-10', '2016-11-11', '2016-11-12', '2016-11-13', '2016-11-14', '2016-11-15', '2016-11-16', '2016-11-17', '2016-11-18', '2016-11-19', '2016-11-20', '2016-11-21', '2016-11-22', '2016-11-23', '2016-11-24', '2016-11-25', '2016-11-26', '2016-11-27', '2016-11-28', '2016-11-29', '2016-11-30', '2016-12-01', '2016-12-02', '2016-12-03', '2016-12-04', '2016-12-05', '2016-12-06', '2016-12-07', '2016-12-08', '2016-12-09', '2016-12-10', '2016-12-11', '2016-12-12', '2016-12-13', '2016-12-14', '2016-12-15', '2016-12-16', '2016-12-17', '2016-12-18', '2016-12-19', '2016-12-20', '2016-12-21', '2016-12-22', '2016-12-23', '2016-12-24', '2016-12-25', '2016-12-26', '2016-12-27', '2016-12-28', '2016-12-29', '2016-12-30', '2017-01-01', '2017-01-02', '2017-01-03', '2017-01-04', '2017-01-05', '2017-01-06', '2017-01-07', '2017-01-08', '2017-01-09', '2017-01-10', '2017-01-11', '2017-01-12', '2017-01-13', '2017-01-14', '2017-01-15', '2017-01-16', '2017-01-17', '2017-01-18', '2017-01-19', '2017-01-20', '2017-01-21', '2017-01-22', '2017-01-23', '2017-01-24', '2017-01-25', '2017-01-26', '2017-01-27', '2017-01-28', '2017-01-29', '2017-01-30', '2017-01-31', '2017-02-01', '2017-02-02', '2017-02-03', '2017-02-04', '2017-02-05', '2017-02-06', '2017-02-07', '2017-02-08', '2017-02-09', '2017-02-10', '2017-02-11', '2017-02-12', '2017-02-13', '2017-02-14', '2017-02-15', '2017-02-16', '2017-02-17', '2017-02-18', '2017-02-19', '2017-02-20', '2017-02-21', '2017-02-22', '2017-02-23', '2017-02-24', '2017-02-25', '2017-02-26', '2017-02-27', '2017-02-28', '2017-03-01', '2017-03-02', '2017-03-03', '2017-03-04', '2017-03-05', '2017-03-06', '2017-03-07', '2017-03-08', '2017-03-09', '2017-03-10', '2017-03-11', '2017-03-12', '2017-03-13', '2017-03-14', '2017-03-15', '2017-03-16', '2017-03-17', '2017-03-18', '2017-03-19', '2017-03-20', '2017-03-21', '2017-03-22', '2017-03-23', '2017-03-24', '2017-03-25', '2017-03-26', '2017-03-27', '2017-03-28', '2017-03-29', '2017-03-30', '2017-03-31', '2017-04-01', '2017-04-02', '2017-04-03', '2017-04-04', '2017-04-05', '2017-04-06', '2017-04-07', '2017-04-08', '2017-04-09', '2017-04-10', '2017-04-11', '2017-04-12', '2017-04-13', '2017-04-14', '2017-04-15', '2017-04-16', '2017-04-17', '2017-04-18', '2017-04-19', '2017-04-20', '2017-04-21', '2017-04-22', '2017-04-23', '2017-04-24', '2017-04-25', '2017-04-26', '2017-04-27', '2017-04-28', '2017-04-29', '2017-04-30', '2017-05-01', '2017-05-02', '2017-05-03', '2017-05-04', '2017-05-05', '2017-05-06', '2017-05-07', '2017-05-08', '2017-05-09', '2017-05-10', '2017-05-11', '2017-05-12', '2017-05-13', '2017-05-14', '2017-05-15', '2017-05-16', '2017-05-17', '2017-05-18', '2017-05-19', '2017-05-20', '2017-05-21', '2017-05-22', '2017-05-23', '2017-05-24', '2017-05-25', '2017-05-26', '2017-05-27', '2017-05-28', '2017-05-29', '2017-05-30', '2017-05-31', '2017-06-01', '2017-06-02', '2017-06-03', '2017-06-04', '2017-06-05', '2017-06-06', '2017-06-07', '2017-06-08', '2017-06-09', '2017-06-10', '2017-06-11', '2017-06-12', '2017-06-13', '2017-06-14', '2017-06-15', '2017-06-16', '2017-06-17', '2017-06-18', '2017-06-19', '2017-06-20', '2017-06-21', '2017-06-22', '2017-06-23', '2017-06-24', '2017-06-25', '2017-06-26', '2017-06-27', '2017-06-28', '2017-06-29', '2017-06-30', '2017-07-01', '2017-07-02', '2017-07-03', '2017-07-04', '2017-07-05', '2017-07-06', '2017-07-07', '2017-07-08', '2017-07-09', '2017-07-10', '2017-07-11', '2017-07-12', '2017-07-13', '2017-07-14', '2017-07-15', '2017-07-16', '2017-07-17', '2017-07-18', '2017-07-19', '2017-07-20', '2017-07-21', '2017-07-22', '2017-07-23', '2017-07-24', '2017-07-25', '2017-07-26', '2017-07-27', '2017-07-28', '2017-07-29', '2017-07-30', '2017-07-31', '2017-08-01', '2017-08-02', '2017-08-03', '2017-08-04', '2017-08-05', '2017-08-06', '2017-08-07', '2017-08-08', '2017-08-09', '2017-08-10', '2017-08-11', '2017-08-12', '2017-08-13', '2017-08-14', '2017-08-15', '2017-08-16', '2017-08-17', '2017-08-18', '2017-08-19', '2017-08-20', '2017-08-21', '2017-08-22', '2017-08-23', '2017-08-24', '2017-08-25', '2017-08-26', '2017-08-27', '2017-08-28', '2017-08-29', '2017-08-30', '2017-08-31', '2017-09-01', '2017-09-02', '2017-09-03', '2017-09-04', '2017-09-05', '2017-09-06', '2017-09-07', '2017-09-08', '2017-09-09', '2017-10-01', '2017-10-02', '2017-10-03', '2017-10-04', '2017-10-05', '2017-10-06', '2017-10-07', '2017-10-08', '2017-10-09', '2017-10-10', '2017-10-11', '2017-10-12', '2017-10-13', '2017-10-14', '2017-10-15', '2017-10-16', '2017-10-17', '2017-10-18', '2017-10-19', '2017-10-20', '2017-10-21', '2017-10-22', '2017-10-23', '2017-10-24', '2017-10-25', '2017-10-26', '2017-10-27', '2017-10-28', '2017-10-29', '2017-10-30', '2017-10-31', '2017-11-01', '2017-11-02', '2017-11-03', '2017-11-04', '2017-11-05', '2017-11-06', '2017-11-07', '2017-11-08', '2017-11-09', '2017-11-10', '2017-11-11', '2017-11-12', '2017-11-13', '2017-11-14', '2017-11-15', '2017-11-16', '2017-11-17', '2017-11-18', '2017-11-19', '2017-11-20', '2017-11-21', '2017-11-22', '2017-11-23', '2017-11-24', '2017-11-25', '2017-11-26', '2017-12-01', '2017-12-02', '2017-12-03', '2017-12-04', '2017-12-05', '2017-12-06', '2017-12-07', '2017-12-08', '2017-12-09', '2017-12-10', '2017-12-11', '2017-12-12', '2017-12-13', '2017-12-14', '2017-12-15', '2017-12-16', '2017-12-17', '2017-12-18', '2017-12-19', '2017-12-20', '2017-12-21', '2017-12-22', '2017-12-23', '2017-12-24'];
    if (periods.length==0) { // This means there are no tiles available, so create a dummy layer.
        var newLayer = new OpenLayers.Layer.TMS("ETcb", "",
            { type: 'png', getURL:overlay_getTileURL, alpha:true, 
              isBaseLayer:false, queryId:"ETcb",
              baseUrl:"",title:"ETcb",
              periods:periods,periodLength:1,
              legendUrl:"http://ec2-54-197-48-121.compute-1.amazonaws.com/dgw//irrig/legend?cmap=et&amp;vmin=0&amp;vmax=0.40&amp;tick_format=1.1f&amp;label=ETcb(in)", 
              visibility:false,
              serverZoomIndices: [ ],
              resolutions: []
        });
    } else {
        var newLayer = new OpenLayers.Layer.TMS("ETcb", "http://ecocast.arc.nasa.gov/gi/sfdb.gi?CA30M_L5L7_ETc/"+periods[periods.length-1]+"/",
            { type: 'png', getURL:overlay_getTileURL, alpha:true, 
              isBaseLayer:false, queryId:"ETcb",
              baseUrl:"http://ecocast.arc.nasa.gov/gi/sfdb.gi?CA30M_L5L7_ETc/",title:"ETcb",
              periods:periods,periodLength:1,
              legendUrl:"http://ec2-54-197-48-121.compute-1.amazonaws.com/dgw//irrig/legend?cmap=et&amp;vmin=0&amp;vmax=0.40&amp;tick_format=1.1f&amp;label=ETcb(in)", 
              visibility:false,
              resolutions: [  4891.9698095703125,
                              2445.9849047851562, 1222.9924523925781, 611.4962261962891,
                              305.74811309814453, 152.87405654907226, 76.43702827453613,
                              38.218514137268066, 19.109257068634033, 9.554628534317017,
                              4.777314267158508, 2.388657133579254, 1.194328566789627,
                              0.5971642833948135],
              serverResolutions: [4891.9698095703125, 2445.9849047851562,
                                1222.9924523925781, 611.4962261962891,
                                305.74811309814453, 152.87405654907226,
                                76.43702827453613, 76.43702827453613,
                              38.218514137268066, 19.109257068634033//, 9.554628534317017,
                              //4.777314267158508
                              ],
              serverZoomIndices: [ 5, 6, 7, 8, 9, 10, 11, 12, 13 ]
        });
    }
    map.addLayer(newLayer);
     
    

    var markers = new OpenLayers.Layer.Vector("Markers",{'displayInLayerSwitcher':false});
    map.addLayer(markers);

    
    
    // Add layer list control  
    var switcherControl = new OpenLayers.Control.LayerSwitcher();
    switcherControl.ascending=false; 
    map.addControl(switcherControl);
    switcherControl.maximizeControl();
    $(".dataLbl").html("SIMS Data Layers");

    map.addControl(new OpenLayers.Control.PanZoomBar());
    map.addControl(new OpenLayers.Control.MousePosition({'formatOutput':
        function(ll){
            if (ll.lat > 0) var latchar='N';
            else var latchar='S';
            if (ll.lon > 0 ) var lonchar='E';
            else var lonchar='W';
            return ll.lat.toFixed(5)+" "+latchar+", "+ll.lon.toFixed(5)+" "+lonchar;
        }})); 
    map.addControl(new OpenLayers.Control.Navigation());
    
    var click = new OpenLayers.Control.Click();
    map.addControl(click);
    click.activate();
    map.zoomToExtent( mapBounds.transform(map.displayProjection, map.projection ) );
    map.events.on({'moveend':updateMapPositionCookie,'changelayer':updateMapLayersCookie});
    map.events.register('changelayer',map,setLegend);
    restoreMapState();
    /*
    $.each(map.getLayersByClass("OpenLayers.Layer.TMS"),function(i,l){
        // TODO: Use *_pct.vrt resource to convert RGB values to approximate pixel values by looking at the color table.
        if (l.baseUrl.indexOf("http://l8est.org")<0){ return }
        $(".olTileImage").load(function(e){
            
            var image = e.target;
            
            var canvas = document.createElement('canvas');
            canvas.width = image.width;
            canvas.height = image.height;
        
            var context = canvas.getContext('2d');
            context.drawImage(image, 0, 0);
        
            imageData = context.getImageData(0, 0, canvas.width, canvas.height);
        
            // Now you can access pixel data from imageData.data.
            // It's a one-dimensional array of RGBA values.
            // Here's an example of how to get a pixel's color at (x,y)
            var x=0;
            var y=0;
            var index = (y*imageData.width + x) * 4;
            var red = imageData.data[index];
            var green = imageData.data[index + 1];
            var blue = imageData.data[index + 2];
            var alpha = imageData.data[index + 3];
            
            //console.log([red,green,blue]);
        
        });
    });
    */
}

function updateMapPositionCookie() {
    $.cookie('map_zoom', map.getZoom(), { expires: 28 });
    $.cookie('map_center', map.getCenter().lon+","+map.getCenter().lat, { expires: 28 });
} 
function updateMapLayersCookie() {
    var activeLayers = [];
    $(".dataLayersDiv input:checked").each(function(i,e){
        activeLayers[activeLayers.length]=map.getLayersByName(e.name)[0].title;
    });
    $.cookie('active_layers',activeLayers.join(','), { expires: 28 });    
}
function restoreMapState() {
    if (($.cookie('map_center')) && ($.cookie('map_zoom'))) {
        var center = $.cookie('map_center').split(',');
        center = new OpenLayers.LonLat(parseFloat(center[0]),parseFloat(center[1]));
        var zoom = parseInt($.cookie('map_zoom'));
        map.moveTo(center,zoom);
        if ($.cookie("active_layers") && $.cookie("active_layers").length>0) {
            var layers = $.cookie("active_layers").split(",");
            $.each(layers, function(i,e) { 
                var l = map.getLayersBy("title",e);
                if (l.length>0) { l[0].setVisibility(true); }
            });
        }
    } else {
        map.zoomIn();map.zoomIn();  // Hack to zoom in a bit so it looks better
        map.getLayersBy("title","ETcb")[0].setVisibility(true);
    }
}
function styleHacks() {
    // Hack to change cursor position style since CSS is being overridden by script
    var mp=dojo.query(".olControlMousePosition")[0];
    mp.style.fontSize="large";
    var ss=dojo.query(".olControlLayerSwitcher")[0].style;
    ss.width='22em';
    ss.marginTop="12px";    
}  
   
function formatDate(d){
    function pad(n){return n<10 ? '0'+n : n}
    return d.getUTCFullYear()+'-'+pad(d.getUTCMonth()+1)+'-'+pad(d.getUTCDate())
}
function daysApart(d1,d2) {
    var d1=Date.parse(d1);
    var d2=Date.parse(d2);
    var dSeconds=d2-d1;
    return dSeconds/(1000*86400);
}
function getValidDate(layer,dStr){
    var lessArr=$(layer.periods).filter(function(i,e){return dStr>=e});
    if (lessArr.length==0) { // This target date is before any available periods. Return false.
        return false;
    } 
    var possibleStartOfPeriod = $(lessArr).get(-1);
    // now check to see if possibleStartOfPeriod is within layer.periodLenth days of dStr
    console.log(daysApart(possibleStartOfPeriod,dStr));
    if ( daysApart(possibleStartOfPeriod,dStr) >= layer.periodLength ) { 
        // There must not be an available period for this target date. 
        return false;
    }
    return possibleStartOfPeriod;
}
function getDateLabel(layer,date){
    if (layer.periods.length==0) { return "Not currently available"; }
    var d0 = getValidDate(layer,date);
    if (d0==false) {return "Not currently available"; }
    d0 = new Date(d0);
    var d1 = dojo.date.add(d0,'day',layer.periodLength-1);
    var resp = formatDate(d0);
    if (d1-d0!=0) resp+=" to "+formatDate(d1)
    return resp
}
function updateLayerLabels(date){
    $.each(map.layers,function(i,layer){
        if (typeof layer.periods != 'undefined') layer.setName(
            layer.title+" <span style='font-size:smaller'></br> &nbsp &nbsp"+getDateLabel(layer,date)+"</span>");
    });
}
function getTopQueryableLayer(){
    var layersWithLegends = dojo.filter( map.layers, function(item){ 
        return typeof item.legendUrl!='undefined' && item.visibility; 
    });
    if (layersWithLegends.length==0) {
        return false
    } else {
        return layersWithLegends[layersWithLegends.length-1];
    }
}
function setLegend(obj){
    // Find layers with a legend URL and set the topmost one as the legend image. 
    var map = obj.object;
    var legendDiv = dojo.query("#legend")[0];
    var legendImg = dojo.query("img", legendDiv);
    legendImg = (legendImg.length==0)? dojo.create("img", {}, legendDiv ) : legendImg[0];
    var topLayer = getTopQueryableLayer();
    if (topLayer) {
        legendImg.src = topLayer.options.legendUrl;
    //if (layersWithLegends.length>0) { 
    //    legendImg.src =layersWithLegends[layersWithLegends.length-1].options.legendUrl;
    } else {
        legendImg.src = '';
    }
}
OpenLayers.Control.Click = OpenLayers.Class(OpenLayers.Control, {                
    defaultHandlerOptions: {                    
    'single': true,
    'double': false,
    'pixelTolerance': 0,
    'stopSingle': false,
    'stopDouble': false

    },
    initialize: function(options) {
        this.handlerOptions = OpenLayers.Util.extend( {}, this.defaultHandlerOptions );
        OpenLayers.Control.prototype.initialize.apply( this, arguments ); 
        this.handler = new OpenLayers.Handler.Click(
            this, {'click': this.trigger}, this.handlerOptions
        );
    }, 
    trigger: function(e) { 
        glob_e=e;
        if (e.target._geometryClass) {
        } else {
            queryMap(map.getLonLatFromViewPortPx(e.xy)); 
        }
    }
});

function addMarker(lonlat){
    var markers=map.getLayersByName("Markers")[0];
    if (markers.features[0]) {onMarkerUnselect(markers.features[0]);}
    markers.removeFeatures(markers.features);
    var newFeature = new OpenLayers.Feature.Vector(
        new OpenLayers.Geometry.Point(lonlat.lon,lonlat.lat));
    markers.addFeatures([newFeature]);
    return newFeature;
}
function queryMap(lonlat){
    querylayers=[];
    $.each(map.layers,function(i,layer){
        if (dojo.isString(layer.queryId) && layer.visibility==true) querylayers[querylayers.length]=layer.title;
    });
    querylayers.reverse();

    var queryUrl="/dgw/irrig/mapQuery?r="+querylayers[0]+"&x="+lonlat.lon+ "&y="+lonlat.lat+"&srid="+map.projection+"&t="+$('#dateSelect').attr('value');
    
    var newFeature = addMarker(lonlat);      

    popup = new OpenLayers.Popup.FramedCloud("popup",
            lonlat,
            null,
            //"<img src='"+imgurl+"'></img><a href='"+imgurl+"&format=csv' target='_blank'>Download as CSV</a>",
            "<div id='query_resp_container'>processing query...</div>",
            null, true);
    newFeature.popup = popup;
    map.addPopup(popup);
    $.ajax(queryUrl,{
        dataType:"html",
        success:function(data){
            $("#query_resp_container").html(data);
            $("#query_resp_tbl").tablesorter(); 
            popup.updateSize();},
        error:function(jqXHR, textStatus, errorThrown){$("#query_resp_container").html(textStatus);}
    });
}

function onMarkerUnselect(feature) {
    if (feature.popup) {
        map.removePopup(feature.popup);
    }
    if (feature.popup) {
        feature.popup.destroy();
    }
    feature.popup = null;
}

function createCalendar() {
    var periods=map.getLayersBy("title","ETcb")[0].periods;

    // create calendar with unavailable dates disabled
    var cal = new dijit.Calendar({
        value: new Date(periods[periods.length-1]),
        isDisabledDate: function(d) {
            var avail = dojo.filter(periods,function(p){
                if (p==formatDate(d)) return true;
                else return false;
            });
            if (avail.length==1) return false;
            else return true;
        }
    },"calendar");
    dojo.byId("dateSelect").value=periods[periods.length-1];
    dojo.connect(cal,"onChange",function(d){
        var ds=dojo.byId("dateSelect");
        var dStr=formatDate(d);
        ds.value=dStr;
        dojo.byId("calendar").style.display='none';
        dojo.forEach(map.layers,function(layer){
            if (typeof layer.periods != 'undefined'){
                layer.url=layer.baseUrl+getValidDate(layer,dStr)+"/";
                layer.redraw();
                updateLayerLabels(dStr);
            }
        });  
    });
    dojo.byId("calendar").style.display='none';    
    
    updateLayerLabels(periods[periods.length-1]);
}
function toggleCalendar() {
    var cal=dojo.byId('calendar');
    if (cal.style.display=='none') {cal.style.display='block';}
    else {cal.style.display='none';}
}
            
function overlay_getTileURL(bounds) {
    var res = this.getServerResolution();
    var x = Math.round((bounds.left - this.maxExtent.left) / (res * this.tileSize.w));
    var y = Math.round((bounds.bottom - this.tileOrigin.lat) / (res * this.tileSize.h));
    var z = this.map.getZoom();
    var zi= this.serverZoomIndices.sort(function(a,b){return b-a});
    if (z>zi[0]) z=zi[0];
    if (mapBounds.intersectsBounds( bounds ) && z >= mapMinZoom && z <= mapMaxZoom ) {
       return this.url + z + "/" + x + "/" + y + "." + this.type;
    } else {
       return "http://www.maptiler.org/img/none.png";
    }
}



dojo.addOnLoad(init);

</script>

     
    <script type="text/javascript">
    $(document).ready(function () {
        // make full screen layout
        $(window).resize(function() {
            $("#content").height($(window).height()-$("#header").outerHeight(true)-$("#footer").outerHeight(true));
            $("#map").height($("#content").height()-$("#toolbarContainer").outerHeight(true));
        });
        $(window).resize();
        
    });
    </script>  
</head>
<body class="tundra">
    <div id="header" class="bordered-container">
        <div id="auth_div">
        
            <h3>Welcome </h3>
        </div>
        <div id="header_logo"><a href="http://ecocast.arc.nasa.gov"><img src="/dgwmed/static/images/planet.png"></a></div>
        <div id="header_title"><h1>TOPS Satellite Irrigation Management Support</h1></div>
    </div>
    <div id="content" class="bordered-container">
        <div id="toolbarContainer">
            <table><tr>
                <td><!--form id="searchForm">-->
                     <label for="searchBox">Go to:</label>
                     <input type="text" name="searchBox" id="searchBox" />
                     <input id="search" type="button" value="Search" onclick="setupFormSubmitListeners()">
                </form></td>
                <td><table id="linksTable"><tr><td align='center'>
                        <a href="https://ecocast.arc.nasa.gov/simsi/about/" target="_blank">About</a>
                        &nbsp&nbsp
                        <a href="https://ecocast.arc.nasa.gov/simsi/help/" target="_blank">Help</a>
                </td></tr></table></td>
                <td align='right'><label for="dateSelect">Select Date:</label>
                    <input type="text" name="dateSelect" id="dateSelect" 
                        dojoType="dijit.form.TextBox" onClick="toggleCalendar()" />
                </td>
            </tr></table>
        </div>
        <div id='calendar'></div>
        <div id="map"></div>
        <div id="legend"></div>
    </div>
    <div id="footer" class="bordered-container">
    	<table><tr>
        <td colspan='3'><div id="disclaimer">Disclaimer:  This data is for research and evaluation purposes only.</div></td>
        </tr><tr>
    	<td>NASA Official: Jennifer Dungan</td>
    	<td>Curator: <a href="http://ecocast.arc.nasa.gov/peop/forrest.php">Forrest Melton</a></td>
    	<td><a href="http://www.nasa.gov/about/highlights/HP_Privacy.html">Privacy Statement</a></td>
    	</tr></table>
    </div>
    
    <!-- html templates to be used for query request forms -->
    <div id="poly_popup_template">            
        <form class="poly_query_form">
                <p>Name: <input type="text" name="feature_name" value="Untitled" size="14"
                    onblur="if (this.value == '') {this.value = 'Untitled'; }"  
                    onfocus="if (this.value == 'Untitled') {this.value = ''; }" /></p>
                <p>Planting Date: <input type="text" name="planting_date" class="datepicker plantingDate" /></p>
                <p>Harvest Date: <input type="text" name="harvest_date" class="datepicker harvestDate" /></p>
                <p>Perennial: <input type="checkbox" name="perennial" class="perennial" /></p>
            <br /><button href='#' class="remove_poly">remove</button> 
            &nbsp &nbsp <button href='#' class='edit_poly'>edit polygon</button> 
            &nbsp &nbsp <button href='#' class='save_poly'>save</button>
            <br /><button href="#" class='show_ts'>Time-series summary chart</button><br />
        </form>
        <div class="timeseries_summary" style="display:none;">
            <select class="year_select">
            <option value="2010">2010</option><option value="2011">2011</option><option value="2012">2012</option><option value="2013">2013</option><option value="2014">2014</option><option value="2015">2015</option><option value="2016">2016</option><option value="2017"selected=true>2017</option>            
            <!--TODO: Create an icon widget for each layer indicating the query status. (processing-yellow,error-red,done-green)
                  Then refactor code use widgets and OO principles! -->
            </select>
            <div class="timeseries_chart_div"></div>
            <br /><button class='back_to_query_form'>Field info</button>
            <button href="/dgw/irrig/feature/query" target="_blank" class="download_data">Download 2017 data</button>
        </div>
        <div class="poly_query_status">&nbsp</div>
    </div>
    <form id="download_data_form" title="Download data as CSV" style="display:none">            
        Select year: <select class="year_select">
        <option value="2010">2010</option><option value="2011">2011</option><option value="2012">2012</option><option value="2013">2013</option><option value="2014">2014</option><option value="2015">2015</option><option value="2016">2016</option><option value="2017"selected=true>2017</option>
        </select>
        <table>
            <tr>
                <td>ETcb</td>
                <td><button url="/dgw/irrig/feature/query"
                target='_blank' class="download_data_button" layername="ETcb">Download as CSV</a></td>
            </tr><tr>
                <td>Crop coefficient (Kcb)</td>
                <td><button url="/dgw/irrig/feature/query"
                target='_blank' class="download_data_button" layername="Crop%20coefficient%20%28Kcb%29">Download as CSV</a></td>
            </tr><tr>
                <td>Fractional Cover (FC)</td>
                <td><button url="/dgw/irrig/feature/query"
                target='_blank' class="download_data_button" layername="Fractional%20Cover%20%28FC%29">Download as CSV</a></td>
            </tr><tr>
                <td>Veg. Index (NDVI) gapfilled</td>
                <td><button url="/dgw/irrig/feature/query"
                target='_blank' class="download_data_button" layername="Veg.%20Index%20%28NDVI%29%20gapfilled">Download as CSV</a></td>
            </tr><tr>
                <td>Veg. Index (NDVI)</td>
                <td><button url="/dgw/irrig/feature/query"
                target='_blank' class="download_data_button" layername="Veg.%20Index%20%28NDVI%29">Download as CSV</a></td>
            </tr>
        </table>
    </form>
</body>
</html>
